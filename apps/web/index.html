<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FDJ ‚Äì Concours IA Euromillions</title>
    
    <!-- Styles CSS int√©gr√©s pour √©viter les probl√®mes de chemins -->
    <!-- CSS LED Components - Conforme bible.md r√®gle 3 -->
    <link rel="stylesheet" href="./led-components.css">
    <!-- CSS Switch Components - Conforme bible.md r√®gle 3 -->
    <link rel="stylesheet" href="./switch-components.css">
    <!-- CSS Homepage Components - Conforme bible.md r√®gle 3 -->
    <link rel="stylesheet" href="./homepage-components.css">
    <!-- CSS Lottery Components - Conforme bible.md r√®gle 3 -->
    <link rel="stylesheet" href="./lottery-components.css">
    <!-- CSS Tirage Components - Conforme bible.md r√®gle 3 -->
    <link rel="stylesheet" href="./tirage-components.css">
    <!-- CSS Tables Components - Conforme bible.md r√®gle 3 -->
    <link rel="stylesheet" href="./tables-components.css">

    <style>
      /* Styles page d'accueil externalis√©s vers homepage-components.css - bible.md conforme */

      /* Boules de loterie externalis√©es vers lottery-components.css - bible.md conforme */

      /* Boutons et status externalis√©s vers homepage-components.css - bible.md conforme */

      /* Tables et s√©lecteurs externalis√©s vers tables-components.css - bible.md conforme */

      /* Page Tirage externalis√©e vers tirage-components.css - bible.md conforme */
      
      /* Styles interrupteur externalis√©s vers switch-components.css - bible.md conforme */
      

      

      

      
      /* Sections r√©sultats et boules externalis√©es vers tirage-components.css et lottery-components.css - bible.md conforme */
      
      /* Tous les styles CSS externalis√©s - BIBLE.MD CONFORME R√àGLE 3 */
      /* - Gains et tableaux ‚Üí tirage-components.css et lottery-components.css */
      /* - Responsive ‚Üí homepage-components.css et tirage-components.css */
    </style>
  </head>
  <body>
    <div class="background"></div>
    
    <header class="topbar">
      <canvas id="menuCanvas" aria-hidden="true"></canvas>
      <img id="logo" src="./assets/yesdata-logo.jpg" alt="YesData" />
      <div class="brand">YesData - EuroMillion</div>
      <nav class="menu">
        <ul class="menu-root">
          <li><a href="#" onclick="showSection('home')">Accueil</a></li>
          <li>
            <span class="menu-head">Tirages</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('tirage')">Tirage</a></li>
              <li><a href="#" onclick="showHistorique()">Historique</a></li>
            </ul>
          </li>
          <li>
            <span class="menu-head">Collecte</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('components')">Lancer scraping</a></li>
              <li><a href="#" onclick="showSection('components')">Sources</a></li>
            </ul>
          </li>
          <li>
            <span class="menu-head">IA</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('status')">Pr√©dictions</a></li>
              <li><a href="#" onclick="showSection('status')">Analyse</a></li>
            </ul>
          </li>
          <li>
            <span class="menu-head">Admin</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('admin-diagnostic')">Diagnostic Base de donn√©es</a></li>
              <li><a href="#" onclick="showSection('admin-monitoring')">Monitoring Base de donn√©es</a></li>
              <li><a href="#" onclick="showSection('components')">Architecture - Documentation</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </header>

    <main class="content">
      <!-- Section Accueil -->
      <section id="home" class="section">
        <h1><span class="home-led"></span> Architecture OOP - FDJ EuroMillion</h1>
        
        <div class="status">
          <h3>‚úÖ Syst√®me Op√©rationnel</h3>
          <p>Cette version fonctionne sans serveur et d√©montre l'architecture OOP refactoris√©e.</p>
        </div>

        <div class="demo-card">
          <h2>üèóÔ∏è Architecture Refactoris√©e</h2>
          <p>Le projet FDJ a √©t√© enti√®rement refactoris√© en programmation orient√©e objet :</p>
          <ul>
            <li><strong>Mod√®les</strong> : Draw, Prediction, DataSource</li>
            <li><strong>Services</strong> : ScrapingService, DataService</li>
            <li><strong>Contr√¥leurs</strong> : DrawController, UIController</li>
            <li><strong>Composants</strong> : LotteryBall, Pagination, DataSourceSelector</li>
            <li><strong>Styles</strong> : CSS modulaires dans style/ClaudS4/</li>
          </ul>
        </div>

        <div class="demo-card">
          <h2>üîß Fonctionnalit√©s Disponibles</h2>
          <button onclick="showSection('demo')">Tester les Composants</button>
          <button onclick="showSection('components')">Voir les √âl√©ments UI</button>
          <button onclick="testArchitecture()">Test Architecture</button>
        </div>
      </section>

      <!-- Section D√©mo -->
      <section id="demo" class="section hidden">
        <!-- Section Historique (non-pliable) -->
        <div class="historique-section">
          <div class="historique-header">
            <h2 class="historique-title">Historique</h2>
            
            <div class="historique-pagination">
              <label for="historiquePagination">R√©sultats par page :</label>
              <select id="historiquePagination" onchange="loadHistoriqueFromDatabase()">
                <option value="10" selected>10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="all">Tous</option>
              </select>
          </div>
        </div>

          <!-- Tableau des tirages sous forme de tags d√©pliables -->
          <div class="tirages-container" id="tiragesContainer">
            <p class="no-data-message">Aucun tirage en base de donn√©es. Effectuez d'abord un scraping depuis la page Tirage.</p>
            </div>
        </div>
      </section>

      <!-- Section Composants -->
      <section id="components" class="section hidden">
        <h1>Architecture - Documentation</h1>

        <!-- Section Structure OOP (pliable) -->
        <div class="demo-card">
          <h2 onclick="toggleArchitectureSection('structure')" class="architecture-section-title">
            <span class="led_generique_petite" id="structure-led"></span>
            Structure des Fichiers OOP
            <span class="architecture-arrow" id="structure-arrow"></span>
          </h2>
          <div id="structure-content" class="architecture-section-content">
            <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; overflow-x: auto;">
src/
‚îú‚îÄ‚îÄ models/                 # Mod√®les de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ Draw.js            # Mod√®le de tirage
‚îÇ   ‚îú‚îÄ‚îÄ Prediction.js      # Mod√®le de pr√©diction IA  
‚îÇ   ‚îî‚îÄ‚îÄ DataSource.js      # Mod√®le de source de donn√©es
‚îú‚îÄ‚îÄ services/              # Services m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ ScrapingService.js # Service de collecte
‚îÇ   ‚îî‚îÄ‚îÄ DataService.js     # Service de donn√©es
‚îú‚îÄ‚îÄ controllers/           # Contr√¥leurs MVC
‚îÇ   ‚îú‚îÄ‚îÄ DrawController.js  # Logique m√©tier des tirages
‚îÇ   ‚îî‚îÄ‚îÄ UIController.js    # Gestion de l'interface
‚îú‚îÄ‚îÄ components/            # Composants UI r√©utilisables
‚îÇ   ‚îú‚îÄ‚îÄ LotteryBallComponent.js
‚îÇ   ‚îú‚îÄ‚îÄ DataSourceSelectorComponent.js
‚îÇ   ‚îî‚îÄ‚îÄ PaginationComponent.js
‚îî‚îÄ‚îÄ index.js              # Point d'entr√©e principal

style/ClaudS4/            # Styles CSS s√©par√©s
‚îú‚îÄ‚îÄ main.css             # Styles principaux
‚îú‚îÄ‚îÄ components.css       # Styles des composants
‚îî‚îÄ‚îÄ scraper-theme.css    # Th√®me scraper
            </pre>
          </div>
        </div>

        <!-- Section Documentation (pliable) -->
        <div class="demo-card">
          <h2 onclick="toggleArchitectureSection('documentation')" class="architecture-section-title">
            <span class="led_generique_petite" id="documentation-led"></span>
            Documentation
            <span class="architecture-arrow" id="documentation-arrow"></span>
          </h2>
          <div id="documentation-content" class="architecture-section-content">
            <ul>
              <li><strong>bible.md</strong> - R√®gles fondamentales du projet</li>
              <li><strong>MIGRATION_GUIDE.md</strong> - Guide de migration</li>
              <li><strong>REFACTORING_SUMMARY.md</strong> - R√©sum√© technique</li>
              <li><strong>tests/compatibility-test.js</strong> - Tests de compatibilit√©</li>
              <li><strong>go.bat</strong> - Script de lancement robuste</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Section Tirage -->
      <section id="tirage" class="section hidden">
        <h1><span class="tirage-led"></span> Tirage</h1>

        <!-- Contr√¥les -->
        <div class="tirage-controls">
          <!-- Ligne 1: Titres -->
          <div class="controls-titles">
            <div class="date-title-section">
              <h4>Date de tirage</h4>
            </div>
            <div class="title-group">
              <h4>Source de donn√©es</h4>
            </div>
          </div>
          
          <!-- Ligne 2: Contr√¥les -->
          <div class="controls-row">
            <div class="date-load-group">
              <div class="date-controls-merged">
                <button onclick="changeDate(-1)" class="date-arrow date-arrow-left">‚óÄ</button>
                <input type="date" id="drawDate" value="2025-08-13">
                <button onclick="changeDate(1)" class="date-arrow date-arrow-right">‚ñ∂</button>
              </div>
              
              <button onclick="loadDraw()" class="load-btn">
                üì• Charger
              </button>
              
              <button onclick="loadDrawForced()" class="load-btn force-btn" title="Forcer un nouveau scraping m√™me si en base">
                üîÑ Force
              </button>
            </div>
            
            <div class="toggle-switch">
              <div class="switch-container">
                <span class="switch-label-left">Scrap</span>
                <div class="led_generique_petite expanded" id="scrapLed"></div>
                <div class="switch scrap">
                  <input type="checkbox" id="dataToggle" checked>
                  <span class="slider"></span>
                </div>
                <div class="led_generique_petite collapsed" id="jsonLed"></div>
                <span class="switch-label-right">Mock</span>
              </div>
            </div>
          </div>
          
          <!-- Ligne 3: Fil d'Ariane -->
          <div class="breadcrumb active" id="dataBreadcrumb">
            <div class="breadcrumb-content">
              <span class="breadcrumb-icon">üåê</span>
              <span class="breadcrumb-text">Source: Scrap (donn√©es r√©elles)</span>
            </div>
          </div>
        </div>

        <!-- Section R√©sultats (pliable) -->
        <div class="gains-section" id="resultsSection" style="display: none;">
          <div class="gains-header" onclick="toggleResults()">
            <h3><span class="led_generique_petite expanded" id="results-led"></span>R√©sultat</h3>
            <span class="gains-toggle expanded" id="resultsToggle"></span>
          </div>
          <div class="gains-content expanded" id="resultsContent">
            <div class="draw-result">
              <div class="draw-date" id="resultDate">Mardi 13 Ao√ªt 2025</div>
              <div class="draw-balls" id="resultBalls">
                <!-- Les boules seront g√©n√©r√©es dynamiquement -->
              </div>
            </div>
          </div>
        </div>

        <!-- Section Gains (pliable) -->
        <div class="gains-section" id="gainsSection" style="display: none;">
          <div class="gains-header" onclick="toggleGains()">
            <h3><span class="led_generique_petite expanded" id="gains-led"></span>Gains et R√©partitions</h3>
            <span class="gains-toggle expanded" id="gainsToggle"></span>
          </div>
          <div class="gains-content expanded" id="gainsContent">
            <table class="gains-table">
              <thead>
                <tr>
                  <th>Rang</th>
                  <th>Combinaison</th>
                  <th>Gagnants</th>
                  <th>Gain par gagnant</th>
                </tr>
              </thead>
              <tbody id="gainsTableBody">
                <!-- Donn√©es g√©n√©r√©es dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="status" style="margin-top: 20px;">
          <p>üí° <strong>Utilisation :</strong> S√©lectionnez une date, choisissez entre donn√©es simul√©es (Mock) ou scraping r√©el (Scrap), puis cliquez sur Charger pour afficher les r√©sultats du tirage.</p>
        </div>
      </section>

      <!-- Section Statut -->
      <section id="status" class="section hidden">
        <h1>üìä Statut du Syst√®me</h1>

        <div class="status">
          <h3>‚úÖ Version Op√©rationnelle</h3>
          <p>Cette version fonctionne avec ou sans serveur HTTP et d√©montre l'architecture refactoris√©e.</p>
        </div>



        <div class="demo-card">
          <h2>üöÄ Pour utiliser la version serveur</h2>
          <ol>
            <li>Installez <strong>live-server</strong> : <code>npm install -g live-server</code></li>
            <li>Lancez le script : <code>go.bat</code></li>
            <li>Ou d√©marrez manuellement : <code>live-server --port=3010</code></li>
          </ol>
          <p><strong>URL serveur :</strong> <a href="http://localhost:3010" target="_blank">http://localhost:3010</a></p>
        </div>
      </section>

      <!-- Section Admin - Diagnostic Base -->
      <section id="admin-diagnostic" class="section hidden">
        <h1>üîç Admin - Diagnostic Base de Donn√©es</h1>
        
        <div class="demo-card">
          <h2>üìä Vue d'ensemble</h2>
          <div id="diagnostic-stats"></div>
          <button onclick="loadDatabaseDiagnostic()">üîÑ Actualiser</button>
        </div>

        <div class="demo-card">
          <h2>üìã Donn√©es Stock√©es</h2>
          <div id="diagnostic-details"></div>
        </div>

        <div class="demo-card">
          <h2>üõ†Ô∏è Actions</h2>
          <button onclick="clearDatabase()">
            üóëÔ∏è Vider la Base
          </button>
          <button onclick="exportDatabase()">
            üì§ Exporter
          </button>
        </div>
      </section>

      <!-- Section Admin - Monitoring Base -->
      <section id="admin-monitoring" class="section hidden">
        <h1>üìä Admin - Monitoring Base de Donn√©es</h1>
        
        <!-- Section principale SQLite (pliable) -->
        <div class="tirage-tag expanded" id="sqlite-main-tirage-tag">
          <div class="tirage-tag-header" onclick="toggleTirageTag('sqlite-main-tirage-tag')">
            <h2>
              <span class="led_generique_petite expanded" id="sqlite-main-led"></span>
              SQLite
            </h2>
            <span class="tirage-expand-arrow">‚ñ≤</span>
          </div>
          <div class="tirage-tag-content">

          <!-- Sous-section 0: Dump SQLite (pliable) -->
          <div class="tirage-tag expanded" id="sqlite-dump-tirage-tag">
            <div class="tirage-tag-header" onclick="toggleTirageTag('sqlite-dump-tirage-tag')">
              <h2>
                <span class="led_generique_petite expanded" id="sqlite-dump-led"></span>
                Dump
              </h2>
              <span class="tirage-expand-arrow">‚ñ≤</span>
            </div>
            <div class="tirage-tag-content">
              <div id="sqlite-dump-content" style="background: #1a1a1a; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; color: #00ff00;">
                <div style="color: #ffff00; margin-bottom: 10px;">üì° SQLite Connection Tracer</div>
                <div>yesdata</div>
                <div style="color: #888; margin-top: 10px;">Attente connexions...</div>
              </div>
            </div>
          </div>

          <!-- Sous-section 1: S√©lection Table SQLite (pliable) -->
          <div class="tirage-tag expanded" id="sqlite-selection-tirage-tag">
            <div class="tirage-tag-header" onclick="toggleTirageTag('sqlite-selection-tirage-tag')">
              <h2>
                <span class="led_generique_petite expanded" id="sqlite-selection-led"></span>
                S√©lection Table
              </h2>
              <span class="tirage-expand-arrow">‚ñ≤</span>
            </div>
            <div class="tirage-tag-content">
              <div class="selector-group">
                <label for="sqliteTableSelector">Table √† surveiller :</label>
                <select id="sqliteTableSelector" onchange="loadSQLiteTableData()">
                  <option value="tirages">Tirages (tirages)</option>
                  <option value="gains">Gains (gains)</option>
                  <option value="all">Toutes les donn√©es</option>
                </select>
              </div>
              <div class="selector-group">
                <label for="sqlitePageSize">R√©sultats par page :</label>
                <select id="sqlitePageSize" onchange="loadSQLiteTableData()">
                  <option value="10" selected>10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Sous-section 2: Donn√©es de la Table SQLite (pliable) -->
          <div class="tirage-tag expanded" id="sqlite-data-tirage-tag">
            <div class="tirage-tag-header" onclick="toggleTirageTag('sqlite-data-tirage-tag')">
              <h2>
                <span class="led_generique_petite expanded" id="sqlite-data-led"></span>
                Donn√©es de la Table
              </h2>
              <span class="tirage-expand-arrow">‚ñ≤</span>
            </div>
            <div class="tirage-tag-content">
              <div id="sqlite-monitoring-stats"></div>
              <div id="sqlite-monitoring-table"></div>
              <div id="sqlite-monitoring-pagination"></div>
            </div>
          </div>
          </div>
        </div>

        <!-- Section principale LocalStorage (pliable) -->
        <div class="tirage-tag expanded" id="localstorage-main-tirage-tag">
          <div class="tirage-tag-header" onclick="toggleTirageTag('localstorage-main-tirage-tag')">
            <h2>
              <span class="led_generique_petite expanded" id="localstorage-main-led"></span>
              LocalStorage
            </h2>
            <span class="tirage-expand-arrow">‚ñ≤</span>
          </div>
          <div class="tirage-tag-content">

          <!-- Sous-section 1: S√©lection Table LocalStorage (pliable) -->
          <div class="tirage-tag expanded" id="localstorage-selection-tirage-tag">
            <div class="tirage-tag-header" onclick="toggleTirageTag('localstorage-selection-tirage-tag')">
              <h2>
                <span class="led_generique_petite expanded" id="localstorage-selection-led"></span>
                S√©lection Table
              </h2>
              <span class="tirage-expand-arrow">‚ñ≤</span>
            </div>
            <div class="tirage-tag-content">
              <div class="selector-group">
                <label for="localstorageTableSelector">Table √† surveiller :</label>
                <select id="localstorageTableSelector" onchange="loadLocalStorageTableData()">
                  <option value="draws">Tirages (draws)</option>
                  <option value="gains">Gains (gains)</option>
                  <option value="all">Toutes les donn√©es</option>
                </select>
              </div>
              <div class="selector-group">
                <label for="localstoragePageSize">R√©sultats par page :</label>
                <select id="localstoragePageSize" onchange="loadLocalStorageTableData()">
                  <option value="10" selected>10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Sous-section 2: Donn√©es de la Table LocalStorage (pliable) -->
          <div class="tirage-tag expanded" id="localstorage-data-tirage-tag">
            <div class="tirage-tag-header" onclick="toggleTirageTag('localstorage-data-tirage-tag')">
              <h2>
                <span class="led_generique_petite expanded" id="localstorage-data-led"></span>
                Donn√©es de la Table
              </h2>
              <span class="tirage-expand-arrow">‚ñ≤</span>
            </div>
            <div class="tirage-tag-content">
              <div id="localstorage-monitoring-stats"></div>
              <div id="localstorage-monitoring-table"></div>
              <div id="localstorage-monitoring-pagination"></div>
            </div>
          </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Mock Data pour les tirages -->
    <script src="./mock-data.js"></script>

    <!-- JavaScript int√©gr√© pour √©viter les probl√®mes de modules ES6 -->
    <script>
      // Navigation entre sections
      function showSection(sectionId) {
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => section.classList.add('hidden'));
        document.getElementById(sectionId).classList.remove('hidden');
        
        // Initialiser les sections sp√©ciales
        if (sectionId === 'admin-diagnostic') {
          loadDatabaseDiagnostic();
        } else if (sectionId === 'admin-monitoring') {
          initializeMonitoringLEDs();
          loadTableData();
        }
      }

      // G√©n√©rateur de tirage al√©atoire
      function generateRandomDraw() {
        const ballsContainer = document.querySelector('.balls');
        ballsContainer.innerHTML = '';
        
        // G√©n√©rer 5 num√©ros uniques entre 1 et 50
        const numbers = [];
        while (numbers.length < 5) {
          const num = Math.floor(Math.random() * 50) + 1;
          if (!numbers.includes(num)) numbers.push(num);
        }
        numbers.sort((a, b) => a - b);
        
        // G√©n√©rer 2 √©toiles uniques entre 1 et 12
        const stars = [];
        while (stars.length < 2) {
          const star = Math.floor(Math.random() * 12) + 1;
          if (!stars.includes(star)) stars.push(star);
        }
        stars.sort((a, b) => a - b);
        
        // Afficher les num√©ros
        numbers.forEach(num => {
          const ball = document.createElement('div');
          ball.className = 'ball';
          ball.textContent = num;
          ballsContainer.appendChild(ball);
        });
        
        // Afficher les √©toiles
        stars.forEach(star => {
          const ball = document.createElement('div');
          ball.className = 'ball star';
          ball.textContent = star;
          ballsContainer.appendChild(ball);
        });
      }

      // Changement de source de donn√©es
      function switchDataSource(source) {
        const status = document.getElementById('sourceStatus');
        if (source === 'json') {
          status.textContent = 'Source active : Fichiers JSON';
        } else {
          status.textContent = 'Source active : Base de donn√©es SQLite';
        }
      }

      // Ajouter une ligne au tableau
      function addRandomRow() {
        const tbody = document.getElementById('drawsTable');
        const row = document.createElement('tr');
        
        const date = new Date().toLocaleDateString('fr-FR');
        
        // G√©n√©rer des num√©ros al√©atoires
        const numbers = [];
        while (numbers.length < 5) {
          const num = Math.floor(Math.random() * 50) + 1;
          if (!numbers.includes(num)) numbers.push(num);
        }
        numbers.sort((a, b) => a - b);
        
        const stars = [];
        while (stars.length < 2) {
          const star = Math.floor(Math.random() * 12) + 1;
          if (!stars.includes(star)) stars.push(star);
        }
        stars.sort((a, b) => a - b);
        
        row.innerHTML = `
          <td>${date}</td>
          <td>${numbers.join(', ')}</td>
          <td>${stars.join(', ')}</td>
          <td>G√©n√©r√©</td>
        `;
        
        tbody.appendChild(row);
      }

      // Test de l'architecture
      function testArchitecture() {
        alert('üéâ Architecture OOP Test√©e!\n\n' +
              '‚úÖ Mod√®les : Draw, Prediction, DataSource\n' +
              '‚úÖ Services : ScrapingService, DataService\n' +
              '‚úÖ Contr√¥leurs : DrawController, UIController\n' +
              '‚úÖ Composants : LotteryBall, Pagination\n' +
              '‚úÖ Styles : CSS modulaires s√©par√©s\n\n' +
              'Toutes les r√®gles de la bible.md sont respect√©es !');
      }

      // Fonctions pour l'historique des tirages
      function showHistorique() {
        showSection('demo');
        loadHistoriqueMock();
      }

      function loadHistoriqueMock() {
        const tbody = document.getElementById('drawsTable');
        const historique = window.mockEuroMillion.getHistorique();
        
        console.log('üìä Chargement historique Mock:', historique.length, 'tirages');
        
        // Vider le tableau
        tbody.innerHTML = '';
        
        // Afficher les 10 derniers tirages
        const recentDraws = historique.slice(-10).reverse(); // Les 10 plus r√©cents, du plus r√©cent au plus ancien
        
        recentDraws.forEach(draw => {
          const row = document.createElement('tr');
          
          // Date
          const dateCell = document.createElement('td');
          dateCell.textContent = draw.date;
          row.appendChild(dateCell);
          
          // Num√©ros
          const numbersCell = document.createElement('td');
          numbersCell.textContent = draw.numbers.join(', ');
          row.appendChild(numbersCell);
          
          // √âtoiles
          const starsCell = document.createElement('td');
          starsCell.innerHTML = `<span style="color: var(--accent);">${draw.stars.join(', ')}</span>`;
          row.appendChild(starsCell);
          
          // Source
          const sourceCell = document.createElement('td');
          sourceCell.innerHTML = '<span style="color: #00e1ff;">Mock</span>';
          row.appendChild(sourceCell);
          
          tbody.appendChild(row);
        });
        
        console.log('‚úÖ Historique Mock affich√©:', recentDraws.length, 'tirages');
      }

      // Diagnostic du syst√®me
      // === FONCTIONS ADMIN ===
      
      // Charger le diagnostic de la base de donn√©es
      function loadDatabaseDiagnostic() {
        const stats = document.getElementById('diagnostic-stats');
        const details = document.getElementById('diagnostic-details');
        
        // Statistiques
        const totalKeys = Object.keys(localStorage).length;
        const drawKeys = Object.keys(localStorage).filter(key => key.startsWith('draw_'));
        const otherKeys = Object.keys(localStorage).filter(key => !key.startsWith('draw_'));
        
        stats.innerHTML = `
          <div class="stats-grid">
            <div class="stat-card">
              <h4 style="color: #00ff00;">üéØ Tirages</h4>
              <p style="color: #00ff00;">${drawKeys.length}</p>
            </div>
            <div class="stat-card">
              <h4 style="color: #ffa500;">üìä Autres Donn√©es</h4>
              <p style="color: #ffa500;">${otherKeys.length}</p>
            </div>
            <div class="stat-card">
              <h4 style="color: #00bfff;">üóÑÔ∏è Total Cl√©s</h4>
              <p style="color: #00bfff;">${totalKeys}</p>
            </div>
          </div>
        `;
        
        // D√©tails des tirages
        if (drawKeys.length > 0) {
          let detailsHtml = `
            <h4>üìã Tirages stock√©s (${drawKeys.length} au total)</h4>
            <div style="max-height: 300px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; padding: 10px;">
          `;
          
          drawKeys.sort().slice(-10).forEach(key => {
            const data = JSON.parse(localStorage.getItem(key));
            const date = key.replace('draw_', '');
            detailsHtml += `
              <div style="border-bottom: 1px solid rgba(255,255,255,0.1); padding: 8px 0;">
                <strong>${date}</strong> - ${data.source || 'Unknown'} 
                ${data.numbers ? `(${data.numbers.join(',')})` : ''}
                <span style="color: #888; font-size: 0.9em;">${data.gains?.length || 0} gains</span>
              </div>
            `;
          });
          
          detailsHtml += '</div>';
          details.innerHTML = detailsHtml;
        } else {
          details.innerHTML = '<p>Aucun tirage stock√© en base de donn√©es.</p>';
        }
      }
      
      // Vider la base de donn√©es
      function clearDatabase() {
        if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir vider toute la base de donn√©es ? Cette action est irr√©versible.')) {
          localStorage.clear();
          loadDatabaseDiagnostic();
          alert('‚úÖ Base de donn√©es vid√©e avec succ√®s.');
        }
      }
      
      // Exporter la base de donn√©es
      function exportDatabase() {
        const data = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          data[key] = JSON.parse(localStorage.getItem(key));
        }
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `fdj_database_export_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
      
      // === MONITORING ===
      let currentPage = 1;
      let currentData = [];
      
      // Charger les donn√©es de la table s√©lectionn√©e
      function loadTableData() {
        const tableType = document.getElementById('tableSelector').value;
        const pageSize = parseInt(document.getElementById('pageSize').value);
        
        currentPage = 1; // Reset √† la page 1
        currentData = getAllTableData(tableType);
        displayTableData(currentData, pageSize, currentPage, tableType);
      }
      
      // R√©cup√©rer toutes les donn√©es selon le type de table
      function getAllTableData(tableType) {
        const data = [];
        
        if (tableType === 'draws' || tableType === 'all') {
          // R√©cup√©rer tous les tirages
          Object.keys(localStorage).filter(key => key.startsWith('draw_')).forEach(key => {
            const drawData = JSON.parse(localStorage.getItem(key));
            const date = key.replace('draw_', '');
            data.push({
              type: 'draw',
              date: date,
              numbers: drawData.numbers?.join(', ') || 'N/A',
              stars: drawData.stars?.join(', ') || 'N/A',
              source: drawData.source || 'Unknown',
              gains: drawData.gains?.length || 0
            });
          });
        }
        
        if (tableType === 'gains' || tableType === 'all') {
          // R√©cup√©rer tous les gains de tous les tirages
          Object.keys(localStorage).filter(key => key.startsWith('draw_')).forEach(key => {
            const drawData = JSON.parse(localStorage.getItem(key));
            const date = key.replace('draw_', '');
            if (drawData.gains) {
              drawData.gains.forEach(gain => {
                data.push({
                  type: 'gain',
                  date: date,
                  rang: gain.rang || gain.rankLabel || 'N/A',
                  gagnants: gain.gagnants || gain.winners || 0,
                  gain: gain.gain || gain.amount || 'N/A',
                  source: drawData.source || 'Unknown'
                });
              });
            }
          });
        }
        
        return data.sort((a, b) => b.date.localeCompare(a.date));
      }
      
      // Afficher les donn√©es dans un tableau avec pagination
      function displayTableData(data, pageSize, page, tableType) {
        const stats = document.getElementById('monitoring-stats');
        const tableDiv = document.getElementById('monitoring-table');
        const pagination = document.getElementById('monitoring-pagination');
        
        // Statistiques
        stats.innerHTML = `<strong>Total: ${data.length} entr√©es</strong> | Page ${page} sur ${Math.ceil(data.length / pageSize)}`;
        
        // Donn√©es pagin√©es
        const startIndex = (page - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        const pageData = data.slice(startIndex, endIndex);
        
        // Cr√©er le tableau
        let tableHtml = '<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
        
        // Headers selon le type
        if (tableType === 'draws') {
          tableHtml += '<tr style="background: rgba(255,255,255,0.1);"><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Date</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Num√©ros</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">√âtoiles</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Source</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Gains</th></tr>';
          pageData.forEach(item => {
            tableHtml += `<tr><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.date}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.numbers}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.stars}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.source}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.gains}</td></tr>`;
          });
        } else if (tableType === 'gains') {
          tableHtml += '<tr style="background: rgba(255,255,255,0.1);"><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Date Tirage</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Rang</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Gagnants</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Montant</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Source</th></tr>';
          pageData.forEach(item => {
            tableHtml += `<tr><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.date}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.rang}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.gagnants}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.gain}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.source}</td></tr>`;
          });
        } else { // all
          tableHtml += '<tr style="background: rgba(255,255,255,0.1);"><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Type</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Date</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Donn√©es</th><th style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Source</th></tr>';
          pageData.forEach(item => {
            const dataText = item.type === 'draw' ? `${item.numbers} | ${item.stars}` : `${item.rang} - ${item.gagnants} gagnants`;
            tableHtml += `<tr><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.type}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.date}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${dataText}</td><td style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">${item.source}</td></tr>`;
          });
        }
        
        tableHtml += '</table>';
        tableDiv.innerHTML = tableHtml;
        
        // Pagination
        const totalPages = Math.ceil(data.length / pageSize);
        let paginationHtml = '';
        
        if (totalPages > 1) {
          paginationHtml += '<div style="display: flex; gap: 10px; align-items: center; justify-content: center;">';
          
          if (page > 1) {
            paginationHtml += `<button onclick="changePage(${page - 1})" style="padding: 5px 10px; background: var(--accent); color: var(--dark); border: none; border-radius: 3px; cursor: pointer;">‚Üê Pr√©c√©dent</button>`;
          }
          
          paginationHtml += `<span>Page ${page} sur ${totalPages}</span>`;
          
          if (page < totalPages) {
            paginationHtml += `<button onclick="changePage(${page + 1})" style="padding: 5px 10px; background: var(--accent); color: var(--dark); border: none; border-radius: 3px; cursor: pointer;">Suivant ‚Üí</button>`;
          }
          
          paginationHtml += '</div>';
        }
        
        pagination.innerHTML = paginationHtml;
      }
      
      // Changer de page
      function changePage(newPage) {
        const pageSize = parseInt(document.getElementById('pageSize').value);
        const tableType = document.getElementById('tableSelector').value;
        currentPage = newPage;
        displayTableData(currentData, pageSize, currentPage, tableType);
      }
      
      // === GESTION SECTIONS PLIABLES MONITORING ===
      
      // √âtat des sections (par d√©faut toutes d√©ploy√©es)
      const monitoringSections = {
        selection: true, // true = d√©ploy√©, false = pli√©
        data: true
      };
      
      // Basculer l'√©tat d'une section
      function toggleMonitoringSection(sectionName) {
        const content = document.getElementById(sectionName + '-content');
        const led = document.getElementById(sectionName + '-led');
        const arrow = document.getElementById(sectionName + '-arrow');
        
        // Basculer l'√©tat
        monitoringSections[sectionName] = !monitoringSections[sectionName];
        
        if (monitoringSections[sectionName]) {
          // D√©plier
          content.classList.remove('collapsed');
          content.classList.add('expanded');
          led.classList.remove('collapsed');
          led.classList.add('expanded');
          arrow.classList.remove('collapsed');
          arrow.classList.add('expanded');
        } else {
          // Plier
          content.classList.remove('expanded');
          content.classList.add('collapsed');
          led.classList.remove('expanded');
          led.classList.add('collapsed');
          arrow.classList.remove('expanded');
          arrow.classList.add('collapsed');
        }
      }
      
      // Initialiser l'√©tat des LEDs pour la page Admin Monitoring
      function initializeMonitoringLEDs() {
        console.log('üîß Initialisation des LEDs Admin Monitoring');
        
        // LEDs des sections principales (SQLite et LocalStorage)
        const mainLeds = ['sqlite-main-led', 'localstorage-main-led'];
        mainLeds.forEach(ledId => {
          const led = document.getElementById(ledId);
          if (led) {
            led.classList.remove('collapsed');
            led.classList.add('expanded');
          }
        });
        
        // LEDs des sous-sections (Dump, S√©lection et Donn√©es)
        const subLeds = ['sqlite-dump-led', 'sqlite-selection-led', 'sqlite-data-led', 'localstorage-selection-led', 'localstorage-data-led'];
        subLeds.forEach(ledId => {
          const led = document.getElementById(ledId);
          if (led) {
            led.classList.remove('collapsed');
            led.classList.add('expanded');
          }
        });
      }
      
      // === NAVIGATION DATE ===
      
      // Changer la date du s√©lecteur
      function changeDate(direction) {
        const dateInput = document.getElementById('drawDate');
        const currentDate = new Date(dateInput.value);
        
        // V√©rifier que la date est valide
        if (isNaN(currentDate.getTime())) {
          console.error('Date invalide dans le s√©lecteur');
          return;
        }
        
        // Ajouter ou soustraire un jour
        currentDate.setDate(currentDate.getDate() + direction);
        
        // Formater la date au format YYYY-MM-DD
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');
        const newDateString = `${year}-${month}-${day}`;
        
        // Mettre √† jour le s√©lecteur
        dateInput.value = newDateString;
        
        console.log(`üìÖ Date chang√©e: ${direction > 0 ? 'suivant' : 'pr√©c√©dent'} ‚Üí ${newDateString}`);
      }

      // Fonction pour dessiner le menu cylindrique
      function drawCylMenu() {
        const menuCanvas = document.getElementById('menuCanvas');
        if (!menuCanvas) return;
        
        const header = document.querySelector('.topbar');
        const dpr = window.devicePixelRatio || 1;
        const w = header.clientWidth;
        const h = header.clientHeight;
        menuCanvas.style.position = 'absolute';
        menuCanvas.style.left = '0';
        menuCanvas.style.top = '0';
        menuCanvas.style.width = w + 'px';
        menuCanvas.style.height = h + 'px';
        menuCanvas.width = Math.floor(w * dpr);
        menuCanvas.height = Math.floor(h * dpr);
        const ctx = menuCanvas.getContext('2d');
        ctx.scale(dpr, dpr);
        ctx.clearRect(0, 0, w, h);

        const radius = Math.min(18, h / 2 - 2);
        const padding = 8;
        const barH = Math.max(h - padding * 2, 12);
        const barW = w - padding * 2;
        const x = padding;
        const y = (h - barH) / 2;

        const grd = ctx.createLinearGradient(0, y, 0, y + barH);
        grd.addColorStop(0, 'rgba(255,255,255,0.18)');
        grd.addColorStop(0.5, 'rgba(255,255,255,0.06)');
        grd.addColorStop(1, 'rgba(0,0,0,0.18)');

        ctx.beginPath();
        roundRect(ctx, x, y, barW, barH, radius);
        ctx.fillStyle = grd;
        ctx.fill();

        // highlight specular
        ctx.beginPath();
        roundRect(ctx, x + 2, y + 2, barW - 4, barH * 0.35, radius * 0.8);
        const hi = ctx.createLinearGradient(0, y + 2, 0, y + 2 + barH * 0.35);
        hi.addColorStop(0, 'rgba(255,255,255,0.25)');
        hi.addColorStop(1, 'rgba(255,255,255,0.02)');
        ctx.fillStyle = hi;
        ctx.fill();

        // shadow bottom
        ctx.beginPath();
        roundRect(ctx, x + 2, y + barH * 0.6, barW - 4, barH * 0.35, radius * 0.8);
        const sh = ctx.createLinearGradient(0, y + barH * 0.6, 0, y + barH);
        sh.addColorStop(0, 'rgba(0,0,0,0.08)');
        sh.addColorStop(1, 'rgba(0,0,0,0.18)');
        ctx.fillStyle = sh;
        ctx.fill();
      }

      function roundRect(ctx, x, y, width, height, radius) {
        const r = Math.max(0, Math.min(radius, height / 2));
        ctx.beginPath();
        ctx.moveTo(x + r, y);
        ctx.lineTo(x + width - r, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + r);
        ctx.lineTo(x + width, y + height - r);
        ctx.quadraticCurveTo(x + width, y + height, x + width - r, y + height);
        ctx.lineTo(x + r, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - r);
        ctx.lineTo(x, y + r);
        ctx.quadraticCurveTo(x, y, x + r, y);
        ctx.closePath();
      }

      // Variables globales pour la page Tirage
      let currentDataSource = 'scrap'; // 'mock' ou 'scrap' - Scrap par d√©faut
      let gainsExpanded = true; // Ouvert par d√©faut
      let resultsExpanded = true; // Ouvert par d√©faut

      // Fonctions pour la page Tirage
      function toggleDataSource() {
        const toggle = document.getElementById('dataToggle');
        const switchElement = document.querySelector('.switch');
        
        // Logique invers√©e : checked = Scrap (√† gauche), unchecked = Mock (√† droite)
        currentDataSource = toggle.checked ? 'scrap' : 'mock';
        console.log('Source de donn√©es chang√©e:', currentDataSource);
        
        // Changer l'apparence visuelle de l'interrupteur selon l'√©tat
        if (toggle.checked) {
          // Mode Scrap actif - style bleu
          switchElement.classList.remove('mock');
          switchElement.classList.add('scrap');
        } else {
          // Mode Mock actif - style gris
          switchElement.classList.remove('scrap');
          switchElement.classList.add('mock');
        }
        
        // Mettre √† jour visuellement les labels
        updateSwitchLabels();
        
        // Mettre √† jour les LEDs
        updateLeds();
        
        // Mettre √† jour le fil d'Ariane
        updateBreadcrumb('source-selected');
      }

      // Fonction pour mettre √† jour les LEDs de l'interrupteur
      function updateLeds() {
        const scrapLed = document.getElementById('scrapLed');
        const jsonLed = document.getElementById('jsonLed');
        
        if (currentDataSource === 'scrap') {
          // Mode Scrap actif (interrupteur √† GAUCHE) : LED Scrap VERTE, LED Mock GRISE
          if (scrapLed) {
            scrapLed.classList.remove('collapsed');
            scrapLed.classList.add('expanded');
          }
          if (jsonLed) {
            jsonLed.classList.remove('expanded');
            jsonLed.classList.add('collapsed');
          }
        } else {
          // Mode Mock actif (interrupteur √† DROITE) : LED Scrap GRISE, LED Mock VERTE
          if (scrapLed) {
            scrapLed.classList.remove('expanded');
            scrapLed.classList.add('collapsed');
          }
          if (jsonLed) {
            jsonLed.classList.remove('collapsed');
            jsonLed.classList.add('expanded');
          }
        }
        
        console.log(`üîÑ LEDs mises √† jour: Scrap=${currentDataSource === 'scrap' ? 'VERT' : 'GRIS'}, Mock=${currentDataSource === 'mock' ? 'VERT' : 'GRIS'}`);
      }

      // Fonction pour vider le tableau des gains
      function clearGainsTable() {
        const gainsSection = document.getElementById('gainsSection');
        const gainsTableBody = document.getElementById('gainsTableBody');
        
        if (gainsTableBody) {
          gainsTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: rgba(255,255,255,0.5); font-style: italic;">Aucune donn√©e de gains disponible</td></tr>';
        }
        
        // Masquer la section des gains si elle √©tait visible
        if (gainsSection) {
          gainsSection.style.display = 'none';
        }
      }

      // Fonction pour mettre √† jour le fil d'Ariane
      function updateBreadcrumb(step = 'init') {
        const breadcrumb = document.getElementById('dataBreadcrumb');
        const icon = breadcrumb.querySelector('.breadcrumb-icon');
        const text = breadcrumb.querySelector('.breadcrumb-text');
        
        // R√©initialiser les classes
        breadcrumb.className = 'breadcrumb';
        
        switch(step) {
          case 'init':
            icon.textContent = 'üîÑ';
            text.textContent = 'S√©lectionnez une date et une source';
            break;
            
          case 'source-selected':
            breadcrumb.classList.add('active');
            icon.textContent = currentDataSource === 'mock' ? 'üé≤' : 'üåê';
            text.textContent = `Source: ${currentDataSource === 'mock' ? 'Mock (donn√©es simul√©es)' : 'Scrap (donn√©es r√©elles)'}`;
            break;
            
          case 'loading-mock':
            breadcrumb.classList.add('active');
            icon.textContent = 'üé≤';
            text.textContent = 'Mock ‚Üí G√©n√©ration de donn√©es simul√©es...';
            break;
            
          case 'loading-scrap':
            breadcrumb.classList.add('active');
            icon.textContent = 'üåê';
            text.textContent = 'Scrap ‚Üí Validation date ‚Üí Requ√™te r√©seau ‚Üí Parsing...';
            break;
            
          case 'success':
            breadcrumb.classList.add('success');
            icon.textContent = '‚úÖ';
            if (currentDataSource === 'mock') {
              text.textContent = 'Mock ‚Üí Donn√©es simul√©es g√©n√©r√©es avec succ√®s';
            } else {
              text.textContent = 'Scrap ‚Üí Date valid√©e ‚Üí Donn√©es r√©cup√©r√©es ‚Üí Parsing r√©ussi';
            }
            break;
            
          case 'error':
            breadcrumb.classList.add('error');
            icon.textContent = '‚ùå';
            text.textContent = 'Erreur lors du chargement des donn√©es';
            break;
            
          case 'no-draw':
            breadcrumb.classList.add('success');
            icon.textContent = 'üìÖ';
            text.textContent = 'Pas de tirage pour cette date (date invalide ou future)';
            break;
        }
      }
      
      function updateSwitchLabels() {
        const toggle = document.getElementById('dataToggle');
        const leftLabel = document.querySelector('.switch-label-left');
        const rightLabel = document.querySelector('.switch-label-right');
        const switchElement = document.querySelector('.switch');
        
        if (toggle.checked) {
          // Mode Scrap actif
          leftLabel.style.opacity = '1';
          leftLabel.style.color = 'var(--accent)';
          rightLabel.style.opacity = '0.6';
          rightLabel.style.color = 'var(--fg)';
          
          // Appliquer les classes actives
          switchElement.classList.remove('mock');
          switchElement.classList.add('scrap');
        } else {
          // Mode Mock actif
          leftLabel.style.opacity = '0.6';
          leftLabel.style.color = 'var(--fg)';
          rightLabel.style.opacity = '1';
          rightLabel.style.color = 'var(--accent)';
          
          // Retirer les classes actives
          switchElement.classList.remove('scrap');
          switchElement.classList.add('mock');
        }
      }
      
      function updateLeds() {
        const toggle = document.getElementById('dataToggle');
        const scrapLed = document.getElementById('scrapLed');
        const jsonLed = document.getElementById('jsonLed');
        
        if (toggle.checked) {
          // Mode Scrap actif
          scrapLed.classList.add('active');
          jsonLed.classList.remove('active');
        } else {
          // Mode Mock actif
          scrapLed.classList.remove('active');
          jsonLed.classList.add('active');
        }
      }

      async function loadDraw() {
        const dateInput = document.getElementById('drawDate');
        const selectedDate = dateInput.value;
        
        if (!selectedDate) {
          alert('Veuillez s√©lectionner une date');
          return;
        }

        console.log('üé≤ Chargement du tirage pour:', selectedDate, 'Source:', currentDataSource);
        
        if (currentDataSource === 'mock') {
          // Mode Mock - affichage direct
          updateBreadcrumb('loading-mock');
          displayDrawResult(selectedDate);
        } else {
          // Mode Scrap - nouvelle strat√©gie avec v√©rification base
          await loadDrawWithStrategy(selectedDate);
        }
      }

      // Charger avec force refresh (ignorer la base)
      async function loadDrawForced() {
        console.log('üîÑ FORCE REFRESH demand√©');
        
        const dateInput = document.getElementById('drawDate');
        const selectedDate = dateInput.value;
        
        if (!selectedDate) {
          alert('Veuillez s√©lectionner une date');
          return;
        }

        if (currentDataSource === 'mock') {
          alert('Le mode Mock ne n√©cessite pas de force refresh');
          return;
        }

        console.log('üéØ Force refresh pour:', selectedDate);
        await loadDrawWithStrategy(selectedDate, true); // forceRefresh = true
      }

      // === NOUVELLE STRAT√âGIE INTELLIGENTE ===
      
      // Strat√©gie: 1) V√©rifier base 2) Si vide‚Üímessage 3) Si absent‚Üíscraper+sauver
      async function loadDrawWithStrategy(selectedDate, forceRefresh = false) {
        console.log('üéØ Strat√©gie intelligente pour:', selectedDate, forceRefresh ? '(FORCE REFRESH)' : '');
        
        // 1. Regarder si la date existe dans la base (sauf si force refresh)
        if (!forceRefresh) {
          const existingDraw = localStorage.getItem(`draw_${selectedDate}`);
          
          if (existingDraw) {
            const drawData = JSON.parse(existingDraw);
            console.log('üìÖ Tirage trouv√© en base:', drawData);
            
            // 2a. Si oui et tirage NON vide ‚Üí afficher
            if (!isEmptyDraw(drawData)) {
              console.log('‚úÖ Tirage valide trouv√© en base, affichage direct');
              updateBreadcrumb('loading-scrap');
              displayDrawFromDatabase(drawData, selectedDate);
              return;
            }
            
            // 2b. Si oui et tirage VIDE ‚Üí message "pas de tirage"
            console.log('‚≠ï Tirage vide trouv√© en base, affichage message');
            displayNoDrawMessage(selectedDate);
            return;
          }
        }
        
        // 3. Si non (ou force refresh) ‚Üí scraper, afficher et mettre en base
        console.log('üåê Aucune donn√©e valide en base, scraping n√©cessaire');
        updateBreadcrumb('loading-scrap');
        await scrapSaveAndDisplay(selectedDate);
      }
      
      // V√©rifier si un tirage est vide (que des 0)
      function isEmptyDraw(drawData) {
        if (!drawData.numbers || !drawData.stars) {
          console.log('üîç Tirage invalide: pas de numbers/stars');
          return true;
        }
        
        // V√©rifier si tous les num√©ros sont 0
        const allNumbersZero = drawData.numbers.every(num => num === 0);
        const allStarsZero = drawData.stars.every(star => star === 0);
        
        const isEmpty = allNumbersZero && allStarsZero;
        console.log('üîç V√©rification tirage vide:', {
          numbers: drawData.numbers,
          stars: drawData.stars,
          isEmpty: isEmpty
        });
        
        return isEmpty;
      }
      
      // Afficher un tirage depuis la base de donn√©es
      function displayDrawFromDatabase(drawData, selectedDate) {
        console.log('üìä Affichage depuis base:', drawData);
        
        const resultsSection = document.getElementById('resultsSection');
        const resultDate = document.getElementById('resultDate');
        const resultBalls = document.getElementById('resultBalls');
        
        // Formatter la date
        const dateObj = new Date(selectedDate + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('fr-FR', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        
        resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
        
        // Cr√©er les boules
        resultBalls.innerHTML = '';
        
        // Boules num√©ros
        drawData.numbers.forEach((number, index) => {
          const ball = document.createElement('span');
          ball.className = 'ball';
          ball.textContent = number;
          resultBalls.appendChild(ball);
        });
        
        // Boules √©toiles
        drawData.stars.forEach((star, index) => {
          const starBall = document.createElement('span');
          starBall.className = 'ball star';
          starBall.textContent = star;
          resultBalls.appendChild(starBall);
        });
        
        resultsSection.style.display = 'block';
        
        // Afficher les gains si disponibles
        if (drawData.gains && drawData.gains.length > 0) {
          displayGainsFromData(drawData);
        }
        
        updateBreadcrumb('success');
        console.log('‚úÖ Affichage base termin√©');
      }
      
      // Afficher le message "pas de tirage trouv√©"
      function displayNoDrawMessage(selectedDate) {
        console.log('‚ÑπÔ∏è Affichage message pas de tirage pour:', selectedDate);
        
        const resultsSection = document.getElementById('resultsSection');
        const resultDate = document.getElementById('resultDate');
        const resultBalls = document.getElementById('resultBalls');
        
        // Formatter la date
        const dateObj = new Date(selectedDate + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('fr-FR', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        
        resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
        
        // Message informatif
        resultBalls.innerHTML = `
          <div style="text-align: center; padding: 30px; color: var(--accent);">
            <div style="font-size: 48px; margin-bottom: 15px;">üìÖ</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">Pas de tirage trouv√©</div>
            <div style="font-size: 14px; color: #888;">Aucun tirage EuroMillions pour cette date</div>
          </div>
        `;
        
        resultsSection.style.display = 'block';
        updateBreadcrumb('info');
        console.log('‚ÑπÔ∏è Message pas de tirage affich√©');
      }
      
      // Scraper, sauvegarder et afficher
      async function scrapSaveAndDisplay(selectedDate) {
        console.log('üåê D√©but scraping + sauvegarde pour:', selectedDate);
        
        try {
          // Utiliser la fonction de scraping existante
          const scrapedData = await scrapDrawFromLotteryExtreme(selectedDate);
          
          if (scrapedData && scrapedData.numbers && scrapedData.stars) {
            console.log('‚úÖ Scraping r√©ussi, donn√©es re√ßues:', scrapedData);
            console.log('üéØ Structure des donn√©es scrapp√©es:', {
              numbers: scrapedData.numbers,
              stars: scrapedData.stars,
              breakdown: scrapedData.breakdown,
              gains: scrapedData.gains,
              breakdownLength: scrapedData.breakdown ? scrapedData.breakdown.length : 'undefined'
            });
            
            // Mapper breakdown vers gains avec format unifi√©
            const gains = (scrapedData.breakdown || []).map(item => ({
              rang: item.rankLabel,
              gagnants: item.winners,
              gain: item.amount,
              // Garder aussi les propri√©t√©s originales pour compatibilit√©
              rankLabel: item.rankLabel,
              winners: item.winners,
              amount: item.amount
            }));
            
            console.log('üéØ Gains mapp√©s pour sauvegarde:', gains);
            
            // Sauvegarder en base
            const dataToSave = {
              date: selectedDate,
              numbers: scrapedData.numbers,
              stars: scrapedData.stars,
              gains: gains,
              source: 'scraped',
              timestamp: new Date().toISOString()
            };
            
            localStorage.setItem(`draw_${selectedDate}`, JSON.stringify(dataToSave));
            console.log('üíæ Donn√©es sauvegard√©es en base');
            
            // V√©rification imm√©diate de la sauvegarde
            const savedData = JSON.parse(localStorage.getItem(`draw_${selectedDate}`));
            console.log('‚úÖ V√©rification sauvegarde - donn√©es r√©cup√©r√©es:', savedData);
            console.log('üéØ V√©rification gains apr√®s sauvegarde:', savedData.gains);
            console.log('üìä Nombre de gains sauvegard√©s:', savedData.gains ? savedData.gains.length : 'undefined');
            
            // Afficher les r√©sultats (utiliser les fonctions existantes)
            console.log('üé® Affichage des r√©sultats...');
            
            // Afficher les boules du tirage
            const resultsSection = document.getElementById('resultsSection');
            const resultDate = document.getElementById('resultDate');
            const resultBalls = document.getElementById('resultBalls');
            
            // Formatter la date
            const dateObj = new Date(selectedDate + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('fr-FR', {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            });
            
            resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
            
            // Cr√©er les boules
            resultBalls.innerHTML = '';
            
            // Boules num√©ros
            scrapedData.numbers.forEach(number => {
              const ball = document.createElement('span');
              ball.className = 'ball';
              ball.textContent = number;
              resultBalls.appendChild(ball);
            });
            
            // Boules √©toiles
            scrapedData.stars.forEach(star => {
              const starBall = document.createElement('span');
              starBall.className = 'ball star';
              starBall.textContent = star;
              resultBalls.appendChild(starBall);
            });
            
            resultsSection.style.display = 'block';
            
            // Afficher les gains avec les donn√©es mapp√©es
            if (scrapedData.breakdown && scrapedData.breakdown.length > 0) {
              console.log('üéØ Affichage des gains avec breakdown:', scrapedData.breakdown);
              
              // Cr√©er un objet compatible avec displayGainsData
              const mockDataForDisplay = {
                gains: gains // Utiliser les gains d√©j√† mapp√©s
              };
              
              console.log('üéØ Donn√©es gains format√©es pour affichage:', mockDataForDisplay);
              displayGainsData(mockDataForDisplay);
            } else {
              console.log('‚ö†Ô∏è Pas de breakdown, affichage gains par d√©faut');
              displayGainsData();
            }
            
            updateBreadcrumb('success');
            
          } else {
            console.log('‚≠ï Scraping retourn√© vide, sauvegarde tirage vide');
            
            // Sauvegarder un tirage vide
            const emptyDraw = {
              date: selectedDate,
              numbers: [0, 0, 0, 0, 0],
              stars: [0, 0],
              gains: [],
              source: 'scraped_empty',
              timestamp: new Date().toISOString()
            };
            
            localStorage.setItem(`draw_${selectedDate}`, JSON.stringify(emptyDraw));
            console.log('üíæ Tirage vide sauvegard√©');
            
            // Afficher le message de tirage vide
            const resultsSection = document.getElementById('resultsSection');
            const resultDate = document.getElementById('resultDate');
            const resultBalls = document.getElementById('resultBalls');
            
            // Formatter la date
            const dateObj = new Date(selectedDate + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('fr-FR', {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            });
            
            resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
            
            resultBalls.innerHTML = `
              <div style="text-align: center; padding: 30px; color: var(--accent);">
                <div style="font-size: 48px; margin-bottom: 15px;">üìÖ</div>
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">Pas de tirage trouv√©</div>
                <div style="font-size: 14px; color: #888;">Aucun tirage EuroMillions pour cette date</div>
              </div>
            `;
            
            resultsSection.style.display = 'block';
            updateBreadcrumb('info');
          }
          
        } catch (error) {
          console.error('‚ùå Erreur de scraping (ne sauvegarde pas):', error);
          
          // NE PAS sauvegarder en cas d'erreur technique
          // Utiliser la gestion d'erreur existante
          const resultsSection = document.getElementById('resultsSection');
          const resultDate = document.getElementById('resultDate');
          const resultBalls = document.getElementById('resultBalls');
          
          // Formatter la date
          const dateObj = new Date(selectedDate + 'T00:00:00');
          const formattedDate = dateObj.toLocaleDateString('fr-FR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          
          resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
          
          // Affichage diff√©renti√© selon le type d'erreur (reprendre la logique existante)
          let messageIcon, messageTitle, messageContent, messageAdvice, isNoDraw = false;
          
          if (error.message.startsWith('NO_DRAW_FOR_DATE') || error.message.startsWith('NOT_DRAW_DAY')) {
            isNoDraw = true;
            messageIcon = 'üìÖ';
            messageTitle = 'Aucun tirage trouv√©';
            messageContent = `Pas de tirage EuroMillions disponible pour le ${selectedDate}`;
            messageAdvice = 'üí° Les tirages EuroMillions ont lieu les mardis et vendredis soir';
          } else if (error.message.startsWith('FUTURE_DATE')) {
            messageIcon = 'üîÆ';
            messageTitle = 'Date future';
            messageContent = `Le tirage du ${selectedDate} n'a pas encore eu lieu`;
            messageAdvice = 'üí° S√©lectionnez une date pass√©e pour voir les r√©sultats';
          } else {
            messageIcon = '‚ö†Ô∏è';
            messageTitle = 'Erreur technique';
            messageContent = 'Impossible de r√©cup√©rer les donn√©es pour le moment';
            messageAdvice = 'üí° V√©rifiez votre connexion internet et r√©essayez';
          }
          
          const messageClass = isNoDraw ? 'info-message' : 'error-message';
          
          resultBalls.innerHTML = `
            <div class="${messageClass}" style="padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0;">
              <div style="font-size: 32px; margin-bottom: 10px;">${messageIcon}</div>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">${messageTitle}</div>
              <div style="font-size: 14px; margin-bottom: 12px;">${messageContent}</div>
              <div style="font-size: 12px; font-style: italic;">${messageAdvice}</div>
            </div>
          `;
          
          resultsSection.style.display = 'block';
          updateBreadcrumb(isNoDraw ? 'info' : 'error');
        }
      }

      function displayDrawResult(date) {
        const resultsSection = document.getElementById('resultsSection');
        const resultDate = document.getElementById('resultDate');
        const resultBalls = document.getElementById('resultBalls');

        // Formatter la date
        const dateObj = new Date(date + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('fr-FR', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);

        // Utiliser les vraies donn√©es Mock
        const drawDate = dateObj.toLocaleDateString('fr-FR');
        let drawData = window.mockEuroMillion.getDrawByDate(drawDate);
        
        if (!drawData) {
          console.log('üìÖ G√©n√©ration nouveau tirage mock pour:', drawDate);
          drawData = window.mockEuroMillion.generateSingleDraw(dateObj);
        }
        
        const numbers = drawData.numbers;
        const stars = drawData.stars;
        console.log('üé≤ Donn√©es Mock charg√©es:', numbers, '√©toiles:', stars);

        // Cr√©er les boules
        resultBalls.innerHTML = '';
        
        // Boules principales
        numbers.forEach(num => {
          const ball = document.createElement('div');
          ball.className = 'ball';
          ball.textContent = num;
          resultBalls.appendChild(ball);
        });

        // √âtoiles
        stars.forEach(star => {
          const ball = document.createElement('div');
          ball.className = 'ball star';
          ball.textContent = star;
          resultBalls.appendChild(ball);
        });

        resultsSection.style.display = 'block';
        
        // Afficher les gains Mock
        console.log('üéØ Appel displayGainsData avec drawData:', drawData);
        displayGainsData(drawData);
        
        // Mettre √† jour le fil d'Ariane
        updateBreadcrumb('success');
      }

      // Fonction de scraping r√©el
      async function performRealScraping(date) {
        const resultsSection = document.getElementById('resultsSection');
        const resultDate = document.getElementById('resultDate');
        const resultBalls = document.getElementById('resultBalls');
        
        try {
          // Formatter la date pour l'affichage
          const dateObj = new Date(date + 'T00:00:00');
          const formattedDate = dateObj.toLocaleDateString('fr-FR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          
          resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
          
          // Afficher un indicateur de chargement
          resultBalls.innerHTML = '<div class="loading">üîÑ Scraping en cours...</div>';
          resultsSection.style.display = 'block';
          
          // Convertir la date au format YYYY-MM-DD pour le scraping
          const scrapDate = date;
          console.log('üåê Scraping pour la date:', scrapDate);
          
          // Appeler le service de scraping (proto)
          const scrapedData = await scrapDrawFromLotteryExtreme(scrapDate);
          
          if (scrapedData && scrapedData.numbers && scrapedData.stars) {
            console.log('‚úÖ Scraping r√©ussi:', scrapedData);
            
            // Mettre √† jour le fil d'Ariane
            updateBreadcrumb('success');
            
            // Afficher les boules scrap√©es
            resultBalls.innerHTML = '';
            
            // Boules principales
            scrapedData.numbers.forEach(num => {
              const ball = document.createElement('div');
              ball.className = 'ball';
              ball.textContent = num;
              resultBalls.appendChild(ball);
            });
            
            // √âtoiles
            scrapedData.stars.forEach(star => {
              const ball = document.createElement('div');
              ball.className = 'ball star';
              ball.textContent = star;
              resultBalls.appendChild(ball);
            });
            
            // Afficher les gains scrap√©s si disponibles
            if (scrapedData.breakdown) {
              displayScrapedGains(scrapedData.breakdown);
            } else {
              displayGainsData(); // Gains par d√©faut
            }
            
          } else {
            throw new Error('Aucune donn√©e trouv√©e pour cette date');
          }
          
        } catch (error) {
          console.error('‚ùå Erreur de scraping:', error);
          
          // Affichage diff√©renti√© selon le type d'erreur
          let messageIcon, messageTitle, messageContent, messageAdvice, isNoDraw = false;
          
          if (error.message.startsWith('NO_DRAW_FOR_DATE')) {
            isNoDraw = true;
            messageIcon = 'üìÖ';
            messageTitle = 'Aucun tirage trouv√©';
            messageContent = `Pas de tirage EuroMillions disponible pour le ${date}`;
            messageAdvice = 'üí° Les tirages EuroMillions ont lieu les mardis et vendredis soir';
          } else if (error.message.startsWith('NOT_DRAW_DAY')) {
            isNoDraw = true;
            const dateObj = new Date(date);
            const dayName = dateObj.toLocaleDateString('fr-FR', { weekday: 'long' });
            messageIcon = 'üìÜ';
            messageTitle = 'Jour incorrect';
            messageContent = `${dayName} n'est pas un jour de tirage EuroMillions`;
            messageAdvice = 'üí° Les tirages ont lieu uniquement les mardis et vendredis';
          } else if (error.message.startsWith('FUTURE_DATE')) {
            messageIcon = 'üîÆ';
            messageTitle = 'Date future';
            messageContent = `Le tirage du ${date} n'a pas encore eu lieu`;
            messageAdvice = 'üí° S√©lectionnez une date pass√©e pour voir les r√©sultats';
          } else if (error.message.startsWith('PARSE_ERROR')) {
            messageIcon = 'üîç';
            messageTitle = 'Erreur de parsing';
            messageContent = 'Donn√©es incompl√®tes trouv√©es sur le site';
            messageAdvice = 'üí° Le format de la page a peut-√™tre chang√©, r√©essayez plus tard';
          } else if (error.message.startsWith('TECHNICAL_ERROR')) {
            messageIcon = '‚ö†Ô∏è';
            messageTitle = 'Erreur technique';
            messageContent = 'Probl√®me de connexion ou de site web';
            messageAdvice = 'üí° V√©rifiez votre connexion Internet et r√©essayez';
          } else {
            messageIcon = '‚ùå';
            messageTitle = 'Erreur inconnue';
            messageContent = error.message;
            messageAdvice = 'üí° Veuillez r√©essayer ou contactez le support';
          }
          
          // Choisir la classe CSS selon le type (vert pour "pas de tirage", rouge pour erreurs)
          const messageClass = isNoDraw ? 'no-draw' : 'error';
          const detailsClass = isNoDraw ? 'no-draw-details' : 'error-details';
          
          // Mettre √† jour le fil d'Ariane
          updateBreadcrumb(isNoDraw ? 'no-draw' : 'error');
          
          // Vider le tableau des gains en cas d'erreur
          clearGainsTable();
          
          // Affichage imm√©diat d'un message court
          resultBalls.innerHTML = `<div class="${messageClass}">${messageIcon} ${messageTitle}</div>`;
          
          // Affichage d√©taill√© apr√®s un d√©lai
          setTimeout(() => {
            resultBalls.innerHTML = `
              <div class="${detailsClass}">
                <p>${messageIcon} <strong>${messageTitle}</strong></p>
                <p><strong>Date:</strong> ${date}</p>
                <p><strong>D√©tail:</strong> ${messageContent}</p>
                <p>${messageAdvice}</p>
                ${isNoDraw ? 
                  '<p><strong>üí° Suggestion:</strong> Essayez avec une date de mardi ou vendredi r√©cente</p>' : ''}
              </div>
            `;
          }, 1000);
        }
      }

      // Fonction de scraping am√©lior√©e avec d√©tection intelligente d'erreurs
      async function scrapDrawFromLotteryExtreme(dateString) {
        try {
          // VALIDATION PR√âLIMINAIRE (avant requ√™te r√©seau)
          const dateObj = new Date(dateString);
          const today = new Date();
          
          // V√©rifier si c'est un jour de tirage (mardi=2, vendredi=5)
          const dayOfWeek = dateObj.getDay();
          if (dayOfWeek !== 2 && dayOfWeek !== 5) {
            console.log('‚ö° D√©tection rapide: Pas un jour de tirage ->', dateString, 'jour:', dayOfWeek);
            throw new Error('NOT_DRAW_DAY');
          }
          
          // V√©rifier si c'est une date future (plus de 1 jour dans le futur pour √©viter les probl√®mes de timezone)
          const tomorrow = new Date(today);
          tomorrow.setDate(today.getDate() + 1);
          if (dateObj > tomorrow) {
            console.log('‚ö° D√©tection rapide: Date future ->', dateString);
            throw new Error('FUTURE_DATE');
          }
          
          console.log('‚úÖ Date valide pour scraping ->', dateString, 'jour:', dayOfWeek);
          
          // Maintenant faire la requ√™te r√©seau
          const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.lotteryextreme.com/euromillions/prize_breakdown(${dateString})`)}`;
          
          console.log('üåê URL de scraping:', url);
          
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`, { cause: 'NETWORK_ERROR' });
          }
          
          const data = await response.json();
          const html = data.contents;
          
          // V√©rifier si la page indique explicitement "pas de tirage"
          if (html.includes('No data available') || 
              html.includes('Draw not found') ||
              html.includes('not yet available') ||
              html.includes('Coming Soon') ||
              html.toLowerCase().includes('no results')) {
            throw new Error('NO_DRAW_FOR_DATE');
          }
          
          // Parser le HTML avec une approche simplifi√©e
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // V√©rifier si on est sur une page d'erreur 404 ou similaire
          const pageTitle = doc.querySelector('title')?.textContent || '';
          if (pageTitle.toLowerCase().includes('404') || 
              pageTitle.toLowerCase().includes('not found') ||
              pageTitle.toLowerCase().includes('error')) {
            throw new Error('NO_DRAW_FOR_DATE');
          }
          
          // Extraire les num√©ros depuis les √©l√©ments .displayball
          const ballElements = doc.querySelectorAll('ul.displayball li');
          const numbers = [];
          
          ballElements.forEach(el => {
            const num = parseInt(el.textContent.trim(), 10);
            if (!isNaN(num)) {
              numbers.push(num);
            }
          });
          
          // Si aucun num√©ro trouv√© apr√®s scraping d'une date valide
          if (numbers.length === 0) {
            throw new Error('NO_DRAW_FOR_DATE');
          }
          
          if (numbers.length < 7) {
            throw new Error(`PARSE_ERROR: expected 7 numbers, got ${numbers.length}`);
          }
          
          const mainNumbers = numbers.slice(0, 5);
          const stars = numbers.slice(5, 7);
          
          // Extraire le tableau des gains
          const breakdown = [];
          const gainRows = doc.querySelectorAll('table.tbsg tr.sg1, table.tbsg tr.sg2');
          
          gainRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 3) {
              const rank = cells[0].textContent.replace(/\s+/g, '');
              const winners = parseInt(cells[1].textContent.replace(/[^0-9]/g, ''), 10) || 0;
              const amount = cells[2].textContent.trim();
              
              if (/^\d+\+\d+$/.test(rank)) {
                breakdown.push({
                  rankLabel: rank,
                  winners: winners,
                  amount: amount,
                  currency: 'EUR'
                });
              }
            }
          });
          
          return {
            date: dateString,
            numbers: mainNumbers,
            stars: stars,
            breakdown: breakdown,
            meta: {
              provider: 'lotteryextreme',
              scrapedAt: new Date().toISOString()
            }
          };
          
        } catch (error) {
          console.error('Erreur de scraping:', error);
          
          // Re-lancer l'erreur avec le message original si c'est une erreur sp√©cifique
          if (error.message.startsWith('NO_DRAW_FOR_DATE') || 
              error.message.startsWith('FUTURE_DATE') || 
              error.message.startsWith('NOT_DRAW_DAY') ||
              error.message.startsWith('PARSE_ERROR')) {
            throw error;
          }
          
          // Pour les autres erreurs, les marquer comme erreurs techniques
          throw new Error(`TECHNICAL_ERROR: ${error.message}`);
        }
      }

      // Fonction pour afficher les gains scrap√©s
      function displayScrapedGains(breakdown) {
        const gainsSection = document.getElementById('gainsSection');
        const gainsTableBody = document.getElementById('gainsTableBody');
        
        if (!breakdown || breakdown.length === 0) {
          gainsTableBody.innerHTML = '<tr><td colspan="4">Aucune donn√©e de gains disponible</td></tr>';
          gainsSection.style.display = 'block';
          return;
        }
        
        gainsTableBody.innerHTML = '';
        
        breakdown.forEach((gain, index) => {
          const row = document.createElement('tr');
          
          // Cr√©er la cellule de combinaison avec ic√¥nes
          const comboCell = document.createElement('td');
          const comboDiv = document.createElement('div');
          comboDiv.className = 'result-combo';
          
          // Mapper les rangs aux combinaisons EuroMillions
          const combos = ['5+2', '5+1', '5+0', '4+2', '4+1', '3+2', '4+0', '2+2', '3+1', '3+0', '1+2', '2+1', '2+0'];
          const comboText = combos[index] || gain.rankLabel;
          
          if (comboText.includes('+')) {
            const [balls, starsCount] = comboText.split('+');
            
            // Ajouter la boule avec le chiffre (utilise les vraies classes de boules)
            const ballIcon = document.createElement('span');
            ballIcon.className = 'ball';
            ballIcon.style.width = '28px';
            ballIcon.style.height = '28px';
            ballIcon.style.fontSize = '14px';
            ballIcon.textContent = balls;
            comboDiv.appendChild(ballIcon);
            
            // Ajouter le signe +
            if (parseInt(starsCount) > 0) {
              const plus = document.createElement('span');
              plus.textContent = ' + ';
              plus.style.margin = '0 4px';
              comboDiv.appendChild(plus);
              
              // Ajouter l'√©toile avec le chiffre (utilise les vraies classes d'√©toiles)
              const starIcon = document.createElement('span');
              starIcon.className = 'ball star';
              starIcon.style.width = '28px';
              starIcon.style.height = '28px';
              starIcon.style.fontSize = '12px';
              starIcon.textContent = starsCount;
              comboDiv.appendChild(starIcon);
            }
          } else {
            comboDiv.textContent = gain.rankLabel;
          }
          
          comboCell.appendChild(comboDiv);
          
          // Cr√©er la cellule de gain
          const gainCell = document.createElement('td');
          const gainSpan = document.createElement('span');
          gainSpan.className = 'gain-amount';
          gainSpan.textContent = gain.amount;
          gainCell.appendChild(gainSpan);
          
          row.innerHTML = `
            <td>Rang ${index + 1}</td>
            <td></td>
            <td>${gain.winners.toLocaleString('fr-FR')}</td>
            <td></td>
          `;
          
          // Remplacer les cellules vides par nos √©l√©ments
          row.cells[1].replaceWith(comboCell);
          row.cells[3].replaceWith(gainCell);
          
          gainsTableBody.appendChild(row);
        });
        
        gainsSection.style.display = 'block';
        console.log('‚úÖ Gains scrap√©s affich√©s:', breakdown.length, 'rangs');
      }

      function displayGainsData(mockDrawData = null) {
        console.log('üéØ displayGainsData appel√©e avec:', mockDrawData);
        console.log('üéØ currentDataSource:', currentDataSource);
        
        const gainsSection = document.getElementById('gainsSection');
        const gainsTableBody = document.getElementById('gainsTableBody');
        
        console.log('üéØ gainsSection trouv√©:', !!gainsSection);
        console.log('üéØ gainsTableBody trouv√©:', !!gainsTableBody);

        let gainsData;
        
        if (mockDrawData && mockDrawData.gains && mockDrawData.gains.length > 0) {
          // Utiliser les donn√©es fournies (Mock ou Scraped)
          gainsData = mockDrawData.gains.map((gain, index) => ({
            rank: index + 1,
            combo: gain.rang || gain.rankLabel || `${index + 1}+0`,
            winners: gain.gagnants || gain.winners || 0,
            gain: gain.gain || gain.amount || 'N/A'
          }));
          console.log('üé≤ Gains fournis charg√©s:', gainsData.length, 'rangs, source:', currentDataSource);
        } else {
          // Donn√©es de gains par d√©faut (Scrap simul√©)
          gainsData = [
            { rank: 1, combo: '5+2', winners: 0, gain: '220 000 000 ‚Ç¨' },
            { rank: 2, combo: '5+1', winners: 3, gain: '852 214 ‚Ç¨' },
            { rank: 3, combo: '5+0', winners: 8, gain: '45 628 ‚Ç¨' },
            { rank: 4, combo: '4+2', winners: 47, gain: '4 086 ‚Ç¨' },
            { rank: 5, combo: '4+1', winners: 892, gain: '215 ‚Ç¨' },
            { rank: 6, combo: '3+2', winners: 1653, gain: '118 ‚Ç¨' },
            { rank: 7, combo: '4+0', winners: 2107, gain: '91 ‚Ç¨' },
            { rank: 8, combo: '2+2', winners: 25847, gain: '25 ‚Ç¨' },
            { rank: 9, combo: '3+1', winners: 38526, gain: '18 ‚Ç¨' },
            { rank: 10, combo: '3+0', winners: 91204, gain: '15 ‚Ç¨' },
            { rank: 11, combo: '1+2', winners: 147852, gain: '8 ‚Ç¨' },
            { rank: 12, combo: '2+1', winners: 698471, gain: '6 ‚Ç¨' },
            { rank: 13, combo: '2+0', winners: 1654820, gain: '4 ‚Ç¨' }
          ];
          console.log('üåê Gains Scrap simul√©s charg√©s');
        }

        // Vider le tableau
        gainsTableBody.innerHTML = '';

        // Remplir le tableau
        gainsData.forEach(data => {
          const row = document.createElement('tr');
          
          // Cr√©er la combinaison avec ic√¥nes
          const comboCell = document.createElement('td');
          const comboDiv = document.createElement('div');
          comboDiv.className = 'result-combo';
          
          const [balls, starsCount] = data.combo.split('+');
          
          // Ajouter la boule avec le chiffre (utilise les vraies classes de boules)
          const ballIcon = document.createElement('span');
          ballIcon.className = 'ball';
          ballIcon.style.width = '28px';
          ballIcon.style.height = '28px';
          ballIcon.style.fontSize = '14px';
          ballIcon.textContent = balls;
          comboDiv.appendChild(ballIcon);
          
          // Ajouter le signe +
          if (parseInt(starsCount) > 0) {
            const plus = document.createElement('span');
            plus.textContent = ' + ';
            plus.style.margin = '0 4px';
            comboDiv.appendChild(plus);
            
            // Ajouter l'√©toile avec le chiffre (utilise les vraies classes d'√©toiles)
            const starIcon = document.createElement('span');
            starIcon.className = 'ball star';
            starIcon.style.width = '28px';
            starIcon.style.height = '28px';
            starIcon.style.fontSize = '12px';
            starIcon.textContent = starsCount;
            comboDiv.appendChild(starIcon);
          }
          
          comboCell.appendChild(comboDiv);

          // Formater le gain
          const gainCell = document.createElement('td');
          const gainSpan = document.createElement('span');
          gainSpan.className = 'gain-amount';
          gainSpan.textContent = data.gain;
          gainCell.appendChild(gainSpan);

          row.innerHTML = `
            <td>${data.rank}</td>
            <td></td>
            <td>${data.winners.toLocaleString('fr-FR')}</td>
            <td></td>
          `;
          
          // Remplacer les cellules vides par nos √©l√©ments
          row.cells[1].replaceWith(comboCell);
          row.cells[3].replaceWith(gainCell);

          gainsTableBody.appendChild(row);
        });

        gainsSection.style.display = 'block';
        console.log('‚úÖ gainsSection affich√©, nombre de lignes ajout√©es:', gainsData.length);
      }

      function toggleResults() {
        const resultsContent = document.getElementById('resultsContent');
        const resultsToggle = document.getElementById('resultsToggle');
        const resultsLed = document.getElementById('results-led');
        
        const isExpanded = resultsContent.classList.contains('expanded');
        
        if (isExpanded) {
          resultsContent.classList.remove('expanded');
          resultsToggle.classList.remove('expanded');
          if (resultsLed) {
            resultsLed.classList.remove('expanded');
            resultsLed.classList.add('collapsed');
          }
        } else {
          resultsContent.classList.add('expanded');
          resultsToggle.classList.add('expanded');
          if (resultsLed) {
            resultsLed.classList.remove('collapsed');
            resultsLed.classList.add('expanded');
          }
        }
      }

      function toggleGains() {
        const gainsContent = document.getElementById('gainsContent');
        const gainsToggle = document.getElementById('gainsToggle');
        const gainsLed = document.getElementById('gains-led');
        
        const isExpanded = gainsContent.classList.contains('expanded');
        
        if (isExpanded) {
          gainsContent.classList.remove('expanded');
          gainsToggle.classList.remove('expanded');
          if (gainsLed) {
            gainsLed.classList.remove('expanded');
            gainsLed.classList.add('collapsed');
          }
        } else {
          gainsContent.classList.add('expanded');
          gainsToggle.classList.add('expanded');
          if (gainsLed) {
            gainsLed.classList.remove('collapsed');
            gainsLed.classList.add('expanded');
          }
        }
      }

      // Afficher la section d'accueil par d√©faut
      document.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ FDJ Architecture OOP - Index unifi√© charg√©');
          
          // DEBUG LED - V√©rification d√©taill√©e
          console.log('üîç DEBUG LED - V√©rification de l\'affichage:');
          
          // 1. V√©rifier si le CSS est charg√©
          const ledCssLink = document.querySelector('link[href*="led-components.css"]');
          console.log('üìÑ LED CSS Link trouv√©:', ledCssLink ? 'OUI' : 'NON');
          if (ledCssLink) {
            console.log('üîó Chemin LED CSS:', ledCssLink.href);
            console.log('üìä √âtat du lien:', ledCssLink.sheet ? 'CHARG√â' : 'NON CHARG√â');
          }
          
          // 2. V√©rifier si l'√©l√©ment LED existe
          const homeLed = document.querySelector('.home-led');
          console.log('üí° √âl√©ment .home-led trouv√©:', homeLed ? 'OUI' : 'NON');
          if (homeLed) {
            console.log('üìê Styles calcul√©s LED:', window.getComputedStyle(homeLed));
            console.log('üé® Background LED:', window.getComputedStyle(homeLed).background);
            console.log('üìè Dimensions LED:', {
              width: window.getComputedStyle(homeLed).width,
              height: window.getComputedStyle(homeLed).height,
              display: window.getComputedStyle(homeLed).display
            });
          }
          
          // 3. Lister tous les styles charg√©s
          console.log('üìã Nombre de feuilles de style:', document.styleSheets.length);
          for (let i = 0; i < document.styleSheets.length; i++) {
            const sheet = document.styleSheets[i];
            console.log(`üìÑ Feuille ${i}:`, sheet.href || 'INLINE');
          }
          
          // Afficher la section home SEULEMENT au premier chargement
          // Si aucune section n'est visible, montrer home par d√©faut
          const visibleSections = document.querySelectorAll('.section:not(.hidden)');
          if (visibleSections.length === 0) {
        showSection('admin-monitoring');
          }
        
        // Dessiner le menu cylindrique
        drawCylMenu();
        
        // Redessiner le menu lors du redimensionnement
        window.addEventListener('resize', drawCylMenu);
        
        // Initialiser l'√©tat de l'interrupteur (Mock par d√©faut)
        setTimeout(() => {
          updateSwitchLabels();
          updateLeds(); // Initialiser les LEDs
        }, 100);
        
        // Ajouter un √©v√©nement click sur l'interrupteur
        const switchElement = document.querySelector('.switch');
        const toggle = document.getElementById('dataToggle');
        
        if (switchElement && toggle) {
          switchElement.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            toggle.checked = !toggle.checked;
            toggleDataSource();
          });
        }
        
        // Afficher un message de confirmation
        setTimeout(() => {
          const status = document.querySelector('.status');
          if (status) {
            status.innerHTML = `
              <h3>‚úÖ Syst√®me Op√©rationnel - ${new Date().toLocaleTimeString()}</h3>
              <p>Cette version fonctionne avec ou sans serveur HTTP et d√©montre l'architecture OOP refactoris√©e.</p>
              <p><strong>JavaScript charg√© et fonctionnel !</strong></p>
              <p><strong>Menu cylindrique activ√© !</strong></p>
            `;
          }
        }, 100);
      });

      // === NOUVELLE PAGE HISTORIQUE ===

      // Fonction pour charger et afficher les tirages depuis la base
      function loadHistoriqueFromDatabase() {
        console.log('üîÑ Chargement de l\'historique depuis la base de donn√©es...');
        
        const container = document.getElementById('tiragesContainer');
        const paginationSelect = document.getElementById('historiquePagination');
        
        if (!container) {
          console.error('‚ùå Container tiragesContainer introuvable');
          return;
        }

        // R√©cup√©rer tous les tirages depuis localStorage
        const draws = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('draw_')) {
            try {
              const drawData = JSON.parse(localStorage.getItem(key));
              if (drawData && drawData.date) {
                draws.push(drawData);
              }
            } catch (error) {
              console.warn('‚ö†Ô∏è Erreur parsing draw:', key, error);
            }
          }
        }

        console.log(`üìä ${draws.length} tirages trouv√©s en base`);

        if (draws.length === 0) {
          container.innerHTML = '<p class="no-data-message">Aucun tirage en base de donn√©es. Effectuez d\'abord un scraping depuis la page Tirage.</p>';
          return;
        }

        // Trier par date (plus r√©cent en premier)
        draws.sort((a, b) => new Date(b.date) - new Date(a.date));

        // Appliquer la pagination
        const pageSize = paginationSelect ? paginationSelect.value : '10';
        let drawsToDisplay = draws;
        
        if (pageSize !== 'all') {
          const limit = parseInt(pageSize);
          drawsToDisplay = draws.slice(0, limit);
          console.log(`üìÑ Affichage de ${drawsToDisplay.length}/${draws.length} tirages (limite: ${pageSize})`);
        } else {
          console.log(`üìÑ Affichage de tous les tirages (${draws.length})`);
        }

        // G√©n√©rer le HTML des tags
        container.innerHTML = drawsToDisplay.map(draw => createTirageTag(draw)).join('');
        
        // Ajouter info de pagination si n√©cessaire
        if (pageSize !== 'all' && draws.length > parseInt(pageSize)) {
          const infoDiv = document.createElement('div');
          infoDiv.style.cssText = 'text-align: center; color: #888; margin-top: 20px; font-size: 14px;';
          infoDiv.innerHTML = `Affichage de ${drawsToDisplay.length} sur ${draws.length} tirages - Modifiez la s√©lection pour voir plus`;
          container.appendChild(infoDiv);
        }
      }

      // Cr√©er un tag de tirage d√©pliable
      function createTirageTag(drawData) {
        const dateObj = new Date(drawData.date + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('fr-FR', {
          weekday: 'short',
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });

        // Cr√©er les boules num√©ros
        const numberBalls = drawData.numbers.map(num => 
          `<span class="ball">${num}</span>`
        ).join('');

        // Cr√©er les boules √©toiles
        const starBalls = drawData.stars.map(star => 
          `<span class="ball star">${star}</span>`
        ).join('');

        // Cr√©er les gains si disponibles
        const gainsHtml = createGainsHtml(drawData.gains || []);

        return `
          <div class="tirage-tag" data-date="${drawData.date}">
            <div class="tirage-tag-header" onclick="toggleTirageTag('${drawData.date}')">
              <div class="tirage-tag-info">
                <div class="tirage-date">${formattedDate}</div>
                <div class="tirage-numbers">
                  ${numberBalls}
                  ${starBalls}
                </div>
                <div class="tirage-source">${drawData.source || 'unknown'}</div>
              </div>
              <div class="tirage-expand-arrow">‚ñº</div>
            </div>
            <div class="tirage-tag-content">
              <div class="tirage-gains">
                <div class="gains-title">Gains et R√©partitions</div>
                ${gainsHtml}
              </div>
            </div>
          </div>
        `;
      }

      // Cr√©er le HTML des gains
      function createGainsHtml(gains) {
        if (!gains || gains.length === 0) {
          return '<p style="color: #888; font-style: italic;">Aucun gain disponible pour ce tirage.</p>';
        }

        const gainsItems = gains.map(gain => {
          // Parser le rang pour cr√©er les boules (ex: "5+2" ‚Üí 5 boules + 2 √©toiles)
          const rang = gain.rang || gain.rankLabel || '';
          const [numbers, stars] = rang.split('+').map(n => parseInt(n) || 0);
          
          // Cr√©er les boules visuelles
          const numberBalls = Array.from({length: numbers}, (_, i) => 
            `<span class="ball">${i + 1}</span>`
          ).join('');
          
          const starBalls = Array.from({length: stars}, (_, i) => 
            `<span class="ball star">${i + 1}</span>`
          ).join('');

          return `
            <div class="gain-item">
              <div class="gain-combo">
                ${numberBalls}${starBalls}
              </div>
              <div class="gain-details">
                <div class="gain-amount">${gain.gain || gain.amount || 'N/A'}</div>
                <div class="gain-winners">${gain.gagnants || gain.winners || 0} gagnant(s)</div>
              </div>
            </div>
          `;
        }).join('');

        return `<div class="gains-grid">${gainsItems}</div>`;
      }

      // Basculer l'√©tat d√©pli√©/pli√© d'un tag (g√©n√©rique)
      function toggleTirageTag(identifier) {
        console.log(`üéØ Clic d√©tect√© sur: ${identifier}`);
        let tag;
        
        // Si l'identifier est un ID, utiliser getElementById
        if (document.getElementById(identifier)) {
          tag = document.getElementById(identifier);
          console.log(`‚úÖ √âl√©ment trouv√© par ID: ${identifier}`);
        } else {
          // Sinon c'est une date, utiliser data-date (pour page Historique)
          tag = document.querySelector(`[data-date="${identifier}"]`);
          console.log(`‚úÖ √âl√©ment trouv√© par data-date: ${identifier}`);
        }
        
        if (tag) {
          const wasExpanded = tag.classList.contains('expanded');
          
          // Basculer la classe expanded
          tag.classList.toggle('expanded');
          
          // Basculer la fl√®che
          const arrow = tag.querySelector('.tirage-expand-arrow');
          if (arrow) {
            arrow.textContent = tag.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
            console.log(`üèπ Fl√®che chang√©e: ${arrow.textContent}`);
          }
          
          // Basculer la LED si elle existe
          const led = tag.querySelector('.led_generique_petite');
          if (led) {
            if (tag.classList.contains('expanded')) {
              led.classList.remove('collapsed');
              led.classList.add('expanded');
            } else {
              led.classList.remove('expanded');
              led.classList.add('collapsed');
            }
            console.log(`üí° LED chang√©e: ${led.classList.contains('expanded') ? 'verte' : 'grise'}`);
          }
          
          console.log(`üîÑ Toggle ${identifier}: ${wasExpanded ? 'expanded' : 'collapsed'} ‚Üí ${tag.classList.contains('expanded') ? 'expanded' : 'collapsed'}`);
        } else {
          console.error(`‚ùå √âl√©ment non trouv√© pour: ${identifier}`);
        }
      }

      // Fonction pour initialiser la page historique
      function showHistorique() {
        showSection('demo');
        setTimeout(() => {
          loadHistoriqueFromDatabase();
        }, 100);
      }

      // === ARCHITECTURE - DOCUMENTATION PAGE ===

      // √âtat des sections Architecture
      const architectureSectionsState = {
        structure: true,     // D√©ploy√©e par d√©faut
        documentation: true  // D√©ploy√©e par d√©faut
      };

      // Basculer l'√©tat d'une section Architecture
      function toggleArchitectureSection(sectionName) {
        const content = document.getElementById(`${sectionName}-content`);
        const led = document.getElementById(`${sectionName}-led`);
        const arrow = document.getElementById(`${sectionName}-arrow`);
        
        if (!content || !led || !arrow) {
          console.error('‚ùå √âl√©ments Architecture introuvables pour:', sectionName);
          return;
        }

        // Basculer l'√©tat
        architectureSectionsState[sectionName] = !architectureSectionsState[sectionName];
        const isExpanded = architectureSectionsState[sectionName];
        
        // Mettre √† jour les classes
        if (isExpanded) {
          content.classList.add('expanded');
          led.classList.remove('collapsed');
          led.classList.add('expanded');
          arrow.classList.add('expanded');
        } else {
          content.classList.remove('expanded');
          led.classList.remove('expanded');
          led.classList.add('collapsed');
          arrow.classList.remove('expanded');
        }
        
        // Mettre √† jour le texte de la fl√®che (‚ñº pour d√©plier, ‚ñ≤ pour replier)
        arrow.textContent = isExpanded ? '‚ñ≤' : '‚ñº';
        
        // Mettre √† jour les classes des fl√®ches
        if (isExpanded) {
          arrow.classList.add('expanded');
          arrow.classList.remove('collapsed');
        } else {
          arrow.classList.add('collapsed');
          arrow.classList.remove('expanded');
        }
        
        console.log(`üîÑ Section Architecture '${sectionName}' ${isExpanded ? 'd√©ploy√©e' : 'pli√©e'}`);
      }

      // Initialiser les LEDs Architecture au chargement de la page
      function initializeArchitectureLEDs() {
        Object.keys(architectureSectionsState).forEach(sectionName => {
          const content = document.getElementById(`${sectionName}-content`);
          const led = document.getElementById(`${sectionName}-led`);
          const arrow = document.getElementById(`${sectionName}-arrow`);
          
          if (content && led && arrow) {
            const isExpanded = architectureSectionsState[sectionName];
            
            if (isExpanded) {
              content.classList.add('expanded');
              led.classList.add('expanded');
              arrow.classList.add('expanded');
              arrow.textContent = '‚ñ≤';  // Fl√®che haute = d√©ploy√©
            } else {
              led.classList.add('collapsed');
              arrow.classList.add('collapsed');
              arrow.textContent = '‚ñº';  // Fl√®che bas = ferm√©
            }
          }
        });
      }

      // === FONCTIONS ADMIN MONITORING ===
      
      // Fonctions SQLite
      function loadSQLiteTableData() {
        const tableSelector = document.getElementById('sqliteTableSelector');
        const pageSize = document.getElementById('sqlitePageSize');
        const tableType = tableSelector.value;
        const limit = parseInt(pageSize.value);
        
        console.log(`üìä SQLite - Chargement table: ${tableType}, limite: ${limit}`);
        
        // TODO: R√©cup√©rer les donn√©es depuis SQLite (pour l'instant vide)
        const data = getSQLiteTableData(tableType);
        
        // Afficher dans la section SQLite
        displaySQLiteTableData(data, limit, 1, tableType);
      }
      
      // Fonctions LocalStorage  
      function loadLocalStorageTableData() {
        const tableSelector = document.getElementById('localstorageTableSelector');
        const pageSize = document.getElementById('localstoragePageSize');
        const tableType = tableSelector.value;
        const limit = parseInt(pageSize.value);
        
        console.log(`üìä LocalStorage - Chargement table: ${tableType}, limite: ${limit}`);
        
        // R√©cup√©rer les donn√©es depuis localStorage
        const data = getLocalStorageTableData(tableType);
        
        // Afficher dans la section LocalStorage
        displayLocalStorageTableData(data, limit, 1, tableType);
      }
      
      // Legacy function pour compatibilit√©
      function loadTableData() {
        loadLocalStorageTableData();
      }
      
      // R√©cup√©rer donn√©es SQLite (√† impl√©menter)
      function getSQLiteTableData(tableType) {
        console.log(`üóÑÔ∏è SQLite: R√©cup√©ration ${tableType} (pas encore impl√©ment√©)`);
        // TODO: Impl√©menter la r√©cup√©ration depuis SQLite
        return []; // Vide pour l'instant
      }
      
      // R√©cup√©rer donn√©es LocalStorage
      function getLocalStorageTableData(tableType) {
        const data = [];
        
        if (tableType === 'draws' || tableType === 'all') {
          // R√©cup√©rer tous les tirages
          Object.keys(localStorage).filter(key => key.startsWith('draw_')).forEach(key => {
            const drawData = JSON.parse(localStorage.getItem(key));
            const date = key.replace('draw_', '');
            data.push({
              type: 'draw',
              date: date,
              numbers: drawData.numbers?.join(', ') || 'N/A',
              stars: drawData.stars?.join(', ') || 'N/A',
              source: drawData.source || 'Unknown',
              gains: drawData.gains?.length || 0
            });
          });
        }
        
        if (tableType === 'gains' || tableType === 'all') {
          // R√©cup√©rer tous les gains de tous les tirages
          Object.keys(localStorage).filter(key => key.startsWith('draw_')).forEach(key => {
            const drawData = JSON.parse(localStorage.getItem(key));
            const date = key.replace('draw_', '');
            if (drawData.gains) {
              drawData.gains.forEach(gain => {
                data.push({
                  type: 'gain',
                  date: date,
                  rang: gain.rang || gain.rankLabel || 'N/A',
                  gagnants: gain.gagnants || gain.winners || 0,
                  gain: gain.gain || gain.amount || 'N/A',
                  source: drawData.source || 'Unknown'
                });
              });
            }
          });
        }
        
        return data.sort((a, b) => b.date.localeCompare(a.date));
      }
      
      // Legacy function pour compatibilit√©
      function getAllTableData(tableType) {
        return getLocalStorageTableData(tableType);
      }
      
      // Afficher donn√©es SQLite
      function displaySQLiteTableData(data, pageSize, page, tableType) {
        const monitoringTable = document.getElementById('sqlite-monitoring-table');
        const monitoringStats = document.getElementById('sqlite-monitoring-stats');
        
        if (!data || data.length === 0) {
          monitoringTable.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">üóÑÔ∏è SQLite pas encore impl√©ment√©.<br/>Les donn√©es appara√Ætront ici une fois la base SQLite configur√©e.</p>';
          monitoringStats.innerHTML = '<div style="text-align: center; color: #888; font-size: 12px;">SQLite : En attente d\'impl√©mentation</div>';
          return;
        }
        
        // La suite sera identique √† displayLocalStorageTableData mais avec des IDs diff√©rents
        displayGenericTableData(data, pageSize, page, tableType, 'sqlite-monitoring-stats', 'sqlite-monitoring-table', 'SQLite');
      }
      
      // Afficher donn√©es LocalStorage  
      function displayLocalStorageTableData(data, pageSize, page, tableType) {
        const monitoringTable = document.getElementById('localstorage-monitoring-table');
        const monitoringStats = document.getElementById('localstorage-monitoring-stats');
        
        if (!data || data.length === 0) {
          monitoringTable.innerHTML = '<p>Aucune donn√©e LocalStorage disponible.</p>';
          monitoringStats.innerHTML = '';
          return;
        }
        
        displayGenericTableData(data, pageSize, page, tableType, 'localstorage-monitoring-stats', 'localstorage-monitoring-table', 'LocalStorage');
      }
      
      // Fonction g√©n√©rique d'affichage
      function displayGenericTableData(data, pageSize, page, tableType, statsId, tableId, sourceLabel) {
        const monitoringTable = document.getElementById(tableId);
        const monitoringStats = document.getElementById(statsId);
        
        if (!data || data.length === 0) {
          monitoringTable.innerHTML = '<p>Aucune donn√©e disponible.</p>';
          monitoringStats.innerHTML = '';
          return;
        }
        
        // Statistiques
        const totalItems = data.length;
        const drawCount = data.filter(item => item.type === 'draw').length;
        const gainCount = data.filter(item => item.type === 'gain').length;
        
        monitoringStats.innerHTML = `
          <div class="stats-container" style="display: flex; gap: 20px; margin-bottom: 15px; font-size: 14px; align-items: center;">
            <span style="background: rgba(128,128,128,0.2); padding: 5px 10px; border-radius: 5px; font-weight: bold;">
              ${sourceLabel}
            </span>
            <span style="background: rgba(52,152,219,0.2); padding: 5px 10px; border-radius: 5px;">
              üìä Total: ${totalItems}
            </span>
            ${drawCount > 0 ? `<span style="background: rgba(46,204,113,0.2); padding: 5px 10px; border-radius: 5px;">üé≤ Tirages: ${drawCount}</span>` : ''}
            ${gainCount > 0 ? `<span style="background: rgba(241,196,15,0.2); padding: 5px 10px; border-radius: 5px;">üí∞ Gains: ${gainCount}</span>` : ''}
          </div>
        `;
        
        // Pagination
        const totalPages = Math.ceil(totalItems / pageSize);
        const startIndex = (page - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, totalItems);
        const pageData = data.slice(startIndex, endIndex);
        
        // Table
        let tableHTML = `<div style="max-height: 400px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.2); border-radius: 5px;">`;
        tableHTML += `<table style="width: 100%; border-collapse: collapse; font-size: 12px;">`;
        
        // Header selon le type
        if (tableType === 'draws' || (tableType === 'all' && drawCount > 0)) {
          tableHTML += `
            <thead style="background: rgba(52,152,219,0.3); position: sticky; top: 0;">
              <tr>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Date</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Num√©ros</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">√âtoiles</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Source</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Gains</th>
              </tr>
            </thead>
          `;
        } else {
          tableHTML += `
            <thead style="background: rgba(241,196,15,0.3); position: sticky; top: 0;">
              <tr>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Date</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Rang</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Gagnants</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Gain</th>
                <th style="padding: 8px; border: 1px solid rgba(255,255,255,0.1);">Source</th>
              </tr>
            </thead>
          `;
        }
        
        tableHTML += '<tbody>';
        pageData.forEach(item => {
          tableHTML += '<tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">';
          if (item.type === 'draw') {
            tableHTML += `
              <td style="padding: 6px;">${item.date}</td>
              <td style="padding: 6px;">${item.numbers}</td>
              <td style="padding: 6px;">${item.stars}</td>
              <td style="padding: 6px;">${item.source}</td>
              <td style="padding: 6px;">${item.gains}</td>
            `;
          } else {
            tableHTML += `
              <td style="padding: 6px;">${item.date}</td>
              <td style="padding: 6px;">${item.rang}</td>
              <td style="padding: 6px;">${item.gagnants}</td>
              <td style="padding: 6px;">${item.gain}</td>
              <td style="padding: 6px;">${item.source}</td>
            `;
          }
          tableHTML += '</tr>';
        });
        tableHTML += '</tbody></table></div>';
        
        // Pagination info
        if (totalPages > 1) {
          tableHTML += `
            <div style="margin-top: 10px; text-align: center; font-size: 12px;">
              Page ${page} sur ${totalPages} (${startIndex + 1}-${endIndex} sur ${totalItems})
            </div>
          `;
        }
        
        monitoringTable.innerHTML = tableHTML;
      }
      
      // Legacy function pour compatibilit√© 
      function displayTableData(data, pageSize, page, tableType) {
        displayLocalStorageTableData(data, pageSize, page, tableType);
      }

      // Ajouter l'initialisation des LEDs Architecture lors de l'affichage de la section
      const originalShowSection = showSection;
      showSection = function(sectionName) {
        originalShowSection(sectionName);
        if (sectionName === 'components') {
          setTimeout(initializeArchitectureLEDs, 100);
        }
        if (sectionName === 'admin-monitoring') {
          // Ouvrir automatiquement la page par d√©faut avec sections d√©pli√©es
          setTimeout(() => {
            initializeMonitoringLEDs();
            loadSQLiteTableData(); // Charger automatiquement SQLite
            loadLocalStorageTableData(); // Charger automatiquement LocalStorage
          }, 100);
        }
        if (sectionName === 'tirage') {
          // Initialiser les LEDs de l'interrupteur quand on va sur la page Tirage
          setTimeout(updateLeds, 100);
        }
      };

      // Initialisation des LEDs au chargement de la page
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Initialisation des LEDs de l\'interrupteur');
        updateLeds();
        
        // Ajouter event listener sur l'interrupteur pour suivre la boule
        const dataToggle = document.getElementById('dataToggle');
        if (dataToggle) {
          dataToggle.addEventListener('change', function() {
            console.log('üîÑ Interrupteur bascul√©, position:', this.checked ? 'GAUCHE (Scrap)' : 'DROITE (Mock)');
            toggleDataSource();
          });
        }
      });

    </script>
  </body>
</html>