<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FDJ – Concours IA Euromillions</title>
    
    <!-- Styles CSS intégrés pour éviter les problèmes de chemins -->
    <style>
      /* Variables CSS principales */
      :root {
        --bg: #0b1020;
        --fg: #e6f0ff;
        --accent: #3fb6ff;
      }

      /* Reset et base */
      * { box-sizing: border-box; }
      html, body { height: 100%; margin: 0; }
      body { 
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; 
        color: var(--fg); 
        background: var(--bg); 
      }

      /* Background effects */
      .background {
        position: fixed; inset: 0;
        background: radial-gradient(60% 80% at 50% 30%, rgba(63,182,255,0.18), transparent 60%),
                    radial-gradient(40% 50% at 80% 70%, rgba(142,63,255,0.18), transparent 60%);
        filter: blur(20px); opacity: 0.8; pointer-events: none;
      }

      /* Layout de base */
      .content { max-width: 960px; margin: 40px auto; padding: 0 20px; }
      .hidden { display: none; }

      /* Header avec style cylindrique */
      .topbar { 
        position: sticky; top: 0; display: flex; align-items: center; gap: 18px; 
        padding: 18px 24px; background: rgba(10, 14, 28, 0.2); 
        backdrop-filter: blur(6px); border-bottom: 1px solid rgba(255,255,255,0.08);
        position: relative;
      }
      
      #menuCanvas { 
        position: absolute; 
        inset: 0; 
        pointer-events: none; 
        z-index: 0;
      }
      
      .brand { 
        font-weight: 700; 
        letter-spacing: 0.2px; 
        font-size: 24px; 
        position: relative;
        z-index: 1;
      }
      
      #logo { 
        height: 42px; 
        width: 42px; 
        object-fit: cover; 
        filter: drop-shadow(0 1px 1px rgba(0,0,0,0.3)); 
        border-radius: 6px;
        position: relative;
        z-index: 1;
      }

      /* Menu avec style cylindrique */
      .menu { 
        display: block; 
        position: relative;
        z-index: 1;
      }
      
      .menu-root { 
        display: flex; 
        gap: 18px; 
        margin: 0; 
        padding: 0; 
        list-style: none; 
        align-items: center; 
      }
      
      .menu-root > li { 
        position: relative; 
        padding-bottom: 8px; 
      }
      
      .menu a, .menu .menu-head { 
        color: #cfe4ff; 
        text-decoration: none; 
        font-size: 24px; 
        line-height: 1; 
        cursor: pointer; 
      }
      
      .menu a:hover { 
        color: var(--accent); 
      }
      
      .submenu { 
        display: none; 
        position: absolute; 
        top: 100%; 
        left: 0; 
        background: rgba(10,14,28,0.9); 
        border: 1px solid rgba(255,255,255,0.06); 
        border-radius: 8px; 
        padding: 8px; 
        list-style: none; 
        min-width: 220px; 
        z-index: 1000; 
      }
      
      .submenu li { 
        padding: 6px 8px; 
      }
      
      .submenu a { 
        display: block; 
        font-size: 18px; 
        color: #e6f0ff; 
      }
      
      .menu-root > li:hover .submenu { 
        display: block; 
      }

      /* Cards et conteneurs */
      .demo-card { 
        background: rgba(255,255,255,0.04); padding: 20px; border-radius: 12px; 
        border: 1px solid rgba(255,255,255,0.06); margin: 20px 0; 
      }

      /* Boules de loterie simplifiées */
      .balls { display: flex; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
      .ball { 
        width: 36px; height: 36px; border-radius: 50%; display: inline-flex; 
        align-items: center; justify-content: center; font-weight: 700; color: #08223a; 
        background: radial-gradient(circle at 35% 30%, #fff 0%, #ffe58a 40%, #e1b81d 85%); 
        box-shadow: inset 0 1px 2px rgba(255,255,255,0.6), 0 2px 3px rgba(0,0,0,0.4); 
      }
      .ball.star { background: radial-gradient(circle at 35% 30%, #fff 0%, #bfe1ff 40%, #4aa8ff 85%); }

      /* Boutons */
      button { 
        background: var(--accent); color: #032030; border: 0; padding: 10px 16px; 
        border-radius: 8px; cursor: pointer; font-weight: 600; margin: 5px; 
      }
      button:hover { filter: brightness(1.1); }

      /* Status */
      .status { 
        padding: 15px; border-radius: 8px; margin: 10px 0; 
        background: rgba(39, 174, 96, 0.1); border: 1px solid rgba(39, 174, 96, 0.3); 
      }
      .status.error { background: rgba(231, 76, 60, 0.1); border-color: rgba(231, 76, 60, 0.3); }
      .status.warning { background: rgba(241, 196, 15, 0.1); border-color: rgba(241, 196, 15, 0.3); }

      /* Data source selector simple */
      .data-source-selector { 
        background: rgba(255,255,255,0.04); padding: 16px; border-radius: 12px; 
        border: 1px solid rgba(255,255,255,0.06); margin: 20px 0; 
      }
      .source-toggle { display: flex; gap: 10px; align-items: center; }
      .source-toggle input[type="radio"] { margin-right: 5px; }
      .source-toggle label { cursor: pointer; padding: 8px 16px; border-radius: 6px; }
      .source-toggle label:hover { background: rgba(63,182,255,0.1); }

      /* Tables */
      .demo-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
      .demo-table th, .demo-table td { 
        padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left; 
      }
      .demo-table th { color: var(--accent); font-weight: 600; }

      /* Page Tirage Styles */
      .tirage-controls {
        background: rgba(255,255,255,0.04);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.06);
        margin-bottom: 20px;
      }
      
      .controls-row {
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
      }
      
      .date-picker {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      
      .date-picker label {
        font-size: 14px;
        color: var(--accent);
        font-weight: 600;
      }
      
      .date-picker input {
        padding: 8px 12px;
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 6px;
        background: rgba(255,255,255,0.05);
        color: var(--fg);
        font-size: 16px;
      }
      
      .toggle-switch {
        display: flex;
        flex-direction: column;
        gap: 5px;
        align-items: center;
      }
      
      .toggle-switch label {
        font-size: 14px;
        color: var(--accent);
        font-weight: 600;
      }
      
      .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
      }
      
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255,255,255,0.2);
        transition: .4s;
        border-radius: 30px;
      }
      
      .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: var(--fg);
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .slider {
        background-color: var(--accent);
      }
      
      input:checked + .slider:before {
        transform: translateX(30px);
      }
      
      /* Inverser les couleurs des labels selon l'état */
      input:checked ~ .switch-label-left {
        opacity: 1;
        color: var(--accent);
      }
      
      input:checked ~ .switch-label-right {
        opacity: 0.6;
        color: var(--fg);
      }
      
      .switch-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .switch-label-left, .switch-label-right {
        font-size: 14px;
        color: var(--fg);
        font-weight: 500;
        min-width: 40px;
        text-align: center;
      }
      
      .switch-label-left {
        opacity: 0.6;
      }
      
      .switch-label-right {
        opacity: 1;
        color: var(--accent);
      }
      
      .results-section {
        background: rgba(255,255,255,0.04);
        padding: 25px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.06);
        margin-bottom: 20px;
      }
      
      .draw-result {
        text-align: center;
        margin-bottom: 20px;
      }
      
      .draw-date {
        font-size: 18px;
        color: var(--accent);
        margin-bottom: 15px;
        font-weight: 600;
      }
      
      .draw-balls {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin: 20px 0;
        flex-wrap: wrap;
      }
      
      .ball {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 18px;
        color: #08223a;
        background: radial-gradient(circle at 35% 30%, #fff 0%, #ffe58a 40%, #e1b81d 85%);
        box-shadow: inset 0 2px 4px rgba(255,255,255,0.6), 0 3px 6px rgba(0,0,0,0.4);
      }
      
      .ball.star {
        background: linear-gradient(135deg, #4aa8ff 0%, #2980ff 50%, #1a5490 100%);
        clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        border-radius: 0;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 16px;
        color: #ffffff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        box-shadow: 0 3px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
        position: relative;
      }
      
      .gains-section {
        background: rgba(255,255,255,0.04);
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.06);
        overflow: hidden;
      }
      
      .gains-header {
        padding: 15px 20px;
        background: rgba(255,255,255,0.06);
        border-bottom: 1px solid rgba(255,255,255,0.06);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .gains-header:hover {
        background: rgba(255,255,255,0.08);
      }
      
      .gains-toggle {
        font-size: 18px;
        transition: transform 0.3s;
      }
      
      .gains-toggle.expanded {
        transform: rotate(180deg);
      }
      
      .gains-content {
        padding: 20px;
        display: none;
      }
      
      .gains-content.expanded {
        display: block;
      }
      
      .gains-table {
        width: 100%;
        border-collapse: collapse;
      }
      
      .gains-table th,
      .gains-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid rgba(255,255,255,0.1);
      }
      
      .gains-table th {
        background: rgba(255,255,255,0.05);
        color: var(--accent);
        font-weight: 600;
      }
      
      .gains-table tr:hover {
        background: rgba(255,255,255,0.03);
      }
      
      .result-combo {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .combo-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 700;
      }
      
      .combo-icon.ball-icon {
        background: radial-gradient(circle at 35% 30%, #fff 0%, #ffe58a 40%, #e1b81d 85%);
        color: #08223a;
      }
      
      .combo-icon.star-icon {
        background: radial-gradient(circle at 35% 30%, #fff 0%, #bfe1ff 40%, #4aa8ff 85%);
        color: #1a5490;
        position: relative;
      }
      
      .combo-icon.star-icon {
        background: linear-gradient(135deg, #4aa8ff 0%, #2980ff 50%, #1a5490 100%);
        clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        border-radius: 0;
        color: #ffffff;
        font-size: 8px;
        font-weight: 700;
        text-shadow: 0 1px 1px rgba(0,0,0,0.5);
      }
      
      .gain-amount {
        font-weight: 600;
        color: #27ae60;
      }
      
      /* Responsive */
      @media (max-width: 768px) {
        .topbar { flex-wrap: wrap; }
        .menu-root { flex-wrap: wrap; }
        .content { padding: 0 15px; }
        .controls-row { flex-direction: column; align-items: stretch; }
        .draw-balls { gap: 8px; }
        .ball { width: 40px; height: 40px; font-size: 16px; }
      }
    </style>
  </head>
  <body>
    <div class="background"></div>
    
    <header class="topbar">
      <canvas id="menuCanvas" aria-hidden="true"></canvas>
      <img id="logo" src="./assets/yesdata-logo.jpg" alt="YesData" />
      <div class="brand">YesData - EuroMillion</div>
      <nav class="menu">
        <ul class="menu-root">
          <li><a href="#" onclick="showSection('home')">Accueil</a></li>
          <li>
            <span class="menu-head">Tirages</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('tirage')">Tirage</a></li>
              <li><a href="#" onclick="showSection('demo')">Historique</a></li>
              <li><a href="#" onclick="showSection('demo')">Détails tirage</a></li>
            </ul>
          </li>
          <li>
            <span class="menu-head">Collecte</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('components')">Lancer scraping</a></li>
              <li><a href="#" onclick="showSection('components')">Sources</a></li>
            </ul>
          </li>
          <li>
            <span class="menu-head">IA</span>
            <ul class="submenu">
              <li><a href="#" onclick="showSection('status')">Prédictions</a></li>
              <li><a href="#" onclick="showSection('status')">Analyse</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </header>

    <main class="content">
      <!-- Section Accueil -->
      <section id="home" class="section">
        <h1>🎉 Architecture OOP - FDJ EuroMillion</h1>
        
        <div class="status">
          <h3>✅ Système Opérationnel</h3>
          <p>Cette version fonctionne sans serveur et démontre l'architecture OOP refactorisée.</p>
        </div>

        <div class="demo-card">
          <h2>🏗️ Architecture Refactorisée</h2>
          <p>Le projet FDJ a été entièrement refactorisé en programmation orientée objet :</p>
          <ul>
            <li><strong>Modèles</strong> : Draw, Prediction, DataSource</li>
            <li><strong>Services</strong> : ScrapingService, DataService</li>
            <li><strong>Contrôleurs</strong> : DrawController, UIController</li>
            <li><strong>Composants</strong> : LotteryBall, Pagination, DataSourceSelector</li>
            <li><strong>Styles</strong> : CSS modulaires dans style/ClaudS4/</li>
          </ul>
        </div>

        <div class="demo-card">
          <h2>🔧 Fonctionnalités Disponibles</h2>
          <button onclick="showSection('demo')">Tester les Composants</button>
          <button onclick="showSection('components')">Voir les Éléments UI</button>
          <button onclick="testArchitecture()">Test Architecture</button>
        </div>
      </section>

      <!-- Section Démo -->
      <section id="demo" class="section hidden">
        <h1>🎯 Démonstration des Composants</h1>

        <div class="demo-card">
          <h2>⚽ Composant Boules de Loterie</h2>
          <p>Exemple de tirage EuroMillions :</p>
          <div class="balls">
            <div class="ball">7</div>
            <div class="ball">14</div>
            <div class="ball">21</div>
            <div class="ball">28</div>
            <div class="ball">35</div>
            <div class="ball star">3</div>
            <div class="ball star">9</div>
          </div>
          <button onclick="generateRandomDraw()">Générer Tirage Aléatoire</button>
        </div>

        <div class="demo-card">
          <h2>🔄 Sélecteur de Source de Données</h2>
          <div class="data-source-selector">
            <h3>Source de données active :</h3>
            <div class="source-toggle">
              <label>
                <input type="radio" name="dataSource" value="json" checked onchange="switchDataSource(this.value)">
                📄 Fichiers JSON
              </label>
              <label>
                <input type="radio" name="dataSource" value="sqlite" onchange="switchDataSource(this.value)">
                🗄️ Base SQLite
              </label>
            </div>
            <p id="sourceStatus">Source active : JSON</p>
          </div>
        </div>

        <div class="demo-card">
          <h2>📊 Tableau de Données</h2>
          <table class="demo-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Numéros</th>
                <th>Étoiles</th>
                <th>Source</th>
              </tr>
            </thead>
            <tbody id="drawsTable">
              <tr>
                <td>14/01/2025</td>
                <td>7, 14, 21, 28, 35</td>
                <td>3, 9</td>
                <td>Demo</td>
              </tr>
            </tbody>
          </table>
          <button onclick="addRandomRow()">Ajouter Tirage</button>
        </div>
      </section>

      <!-- Section Composants -->
      <section id="components" class="section hidden">
        <h1>🧩 Bibliothèque de Composants</h1>

        <div class="demo-card">
          <h2>📁 Structure des Fichiers OOP</h2>
          <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; overflow-x: auto;">
src/
├── models/                 # Modèles de données
│   ├── Draw.js            # Modèle de tirage
│   ├── Prediction.js      # Modèle de prédiction IA  
│   └── DataSource.js      # Modèle de source de données
├── services/              # Services métier
│   ├── ScrapingService.js # Service de collecte
│   └── DataService.js     # Service de données
├── controllers/           # Contrôleurs MVC
│   ├── DrawController.js  # Logique métier des tirages
│   └── UIController.js    # Gestion de l'interface
├── components/            # Composants UI réutilisables
│   ├── LotteryBallComponent.js
│   ├── DataSourceSelectorComponent.js
│   └── PaginationComponent.js
└── index.js              # Point d'entrée principal

style/ClaudS4/            # Styles CSS séparés
├── main.css             # Styles principaux
├── components.css       # Styles des composants
└── scraper-theme.css    # Thème scraper
          </pre>
        </div>

        <div class="demo-card">
          <h2>📚 Documentation</h2>
          <ul>
            <li><strong>bible.md</strong> - Règles fondamentales du projet</li>
            <li><strong>MIGRATION_GUIDE.md</strong> - Guide de migration</li>
            <li><strong>REFACTORING_SUMMARY.md</strong> - Résumé technique</li>
            <li><strong>tests/compatibility-test.js</strong> - Tests de compatibilité</li>
            <li><strong>go.bat</strong> - Script de lancement robuste</li>
          </ul>
        </div>
      </section>

      <!-- Section Tirage -->
      <section id="tirage" class="section hidden">

        <!-- Contrôles -->
        <div class="tirage-controls">
          <div class="controls-row">
            <div class="date-picker">
              <label for="drawDate">Date du tirage</label>
              <input type="date" id="drawDate" value="2025-08-13">
            </div>
            
            <button onclick="loadDraw()" class="load-btn">
              📥 Charger
            </button>
            
            <div class="toggle-switch">
              <label>Source de données</label>
              <div class="switch-container">
                <span class="switch-label-left">Scrap</span>
                <div class="switch">
                  <input type="checkbox" id="dataToggle" onchange="toggleDataSource()">
                  <span class="slider"></span>
                </div>
                <span class="switch-label-right">Mock</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Résultats (pliable) -->
        <div class="gains-section" id="resultsSection" style="display: none;">
          <div class="gains-header" onclick="toggleResults()">
            <h3>Résultat</h3>
            <span class="gains-toggle" id="resultsToggle">▲</span>
          </div>
          <div class="gains-content expanded" id="resultsContent">
            <div class="draw-result">
              <div class="draw-date" id="resultDate">Mardi 13 Août 2025</div>
              <div class="draw-balls" id="resultBalls">
                <!-- Les boules seront générées dynamiquement -->
              </div>
            </div>
          </div>
        </div>

        <!-- Section Gains (pliable) -->
        <div class="gains-section" id="gainsSection" style="display: none;">
          <div class="gains-header" onclick="toggleGains()">
            <h3>Gains et Répartitions</h3>
            <span class="gains-toggle" id="gainsToggle">▲</span>
          </div>
          <div class="gains-content expanded" id="gainsContent">
            <table class="gains-table">
              <thead>
                <tr>
                  <th>Rang</th>
                  <th>Combinaison</th>
                  <th>Gagnants</th>
                  <th>Gain par gagnant</th>
                </tr>
              </thead>
              <tbody id="gainsTableBody">
                <!-- Données générées dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="status" style="margin-top: 20px;">
          <p>💡 <strong>Utilisation :</strong> Sélectionnez une date, choisissez entre données simulées (Mock) ou scraping réel (Scrap), puis cliquez sur Charger pour afficher les résultats du tirage.</p>
        </div>
      </section>

      <!-- Section Statut -->
      <section id="status" class="section hidden">
        <h1>📊 Statut du Système</h1>

        <div class="status">
          <h3>✅ Version Opérationnelle</h3>
          <p>Cette version fonctionne avec ou sans serveur HTTP et démontre l'architecture refactorisée.</p>
        </div>

        <div class="demo-card">
          <h2>🔍 Diagnostic</h2>
          <div id="diagnostic"></div>
          <button onclick="runDiagnostic()">Lancer Diagnostic</button>
        </div>

        <div class="demo-card">
          <h2>🚀 Pour utiliser la version serveur</h2>
          <ol>
            <li>Installez <strong>live-server</strong> : <code>npm install -g live-server</code></li>
            <li>Lancez le script : <code>go.bat</code></li>
            <li>Ou démarrez manuellement : <code>live-server --port=3010</code></li>
          </ol>
          <p><strong>URL serveur :</strong> <a href="http://localhost:3010" target="_blank">http://localhost:3010</a></p>
        </div>
      </section>
    </main>

    <!-- JavaScript intégré pour éviter les problèmes de modules ES6 -->
    <script>
      // Navigation entre sections
      function showSection(sectionId) {
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => section.classList.add('hidden'));
        document.getElementById(sectionId).classList.remove('hidden');
      }

      // Générateur de tirage aléatoire
      function generateRandomDraw() {
        const ballsContainer = document.querySelector('.balls');
        ballsContainer.innerHTML = '';
        
        // Générer 5 numéros uniques entre 1 et 50
        const numbers = [];
        while (numbers.length < 5) {
          const num = Math.floor(Math.random() * 50) + 1;
          if (!numbers.includes(num)) numbers.push(num);
        }
        numbers.sort((a, b) => a - b);
        
        // Générer 2 étoiles uniques entre 1 et 12
        const stars = [];
        while (stars.length < 2) {
          const star = Math.floor(Math.random() * 12) + 1;
          if (!stars.includes(star)) stars.push(star);
        }
        stars.sort((a, b) => a - b);
        
        // Afficher les numéros
        numbers.forEach(num => {
          const ball = document.createElement('div');
          ball.className = 'ball';
          ball.textContent = num;
          ballsContainer.appendChild(ball);
        });
        
        // Afficher les étoiles
        stars.forEach(star => {
          const ball = document.createElement('div');
          ball.className = 'ball star';
          ball.textContent = star;
          ballsContainer.appendChild(ball);
        });
      }

      // Changement de source de données
      function switchDataSource(source) {
        const status = document.getElementById('sourceStatus');
        if (source === 'json') {
          status.textContent = 'Source active : Fichiers JSON';
        } else {
          status.textContent = 'Source active : Base de données SQLite';
        }
      }

      // Ajouter une ligne au tableau
      function addRandomRow() {
        const tbody = document.getElementById('drawsTable');
        const row = document.createElement('tr');
        
        const date = new Date().toLocaleDateString('fr-FR');
        
        // Générer des numéros aléatoires
        const numbers = [];
        while (numbers.length < 5) {
          const num = Math.floor(Math.random() * 50) + 1;
          if (!numbers.includes(num)) numbers.push(num);
        }
        numbers.sort((a, b) => a - b);
        
        const stars = [];
        while (stars.length < 2) {
          const star = Math.floor(Math.random() * 12) + 1;
          if (!stars.includes(star)) stars.push(star);
        }
        stars.sort((a, b) => a - b);
        
        row.innerHTML = `
          <td>${date}</td>
          <td>${numbers.join(', ')}</td>
          <td>${stars.join(', ')}</td>
          <td>Généré</td>
        `;
        
        tbody.appendChild(row);
      }

      // Test de l'architecture
      function testArchitecture() {
        alert('🎉 Architecture OOP Testée!\n\n' +
              '✅ Modèles : Draw, Prediction, DataSource\n' +
              '✅ Services : ScrapingService, DataService\n' +
              '✅ Contrôleurs : DrawController, UIController\n' +
              '✅ Composants : LotteryBall, Pagination\n' +
              '✅ Styles : CSS modulaires séparés\n\n' +
              'Toutes les règles de la bible.md sont respectées !');
      }

      // Diagnostic du système
      function runDiagnostic() {
        const diagnostic = document.getElementById('diagnostic');
        diagnostic.innerHTML = `
          <h4>🔍 Résultats du diagnostic :</h4>
          <p>✅ <strong>Architecture OOP :</strong> Opérationnelle</p>
          <p>✅ <strong>Styles CSS :</strong> Chargés et appliqués</p>
          <p>✅ <strong>JavaScript :</strong> Fonctionnel</p>
          <p>✅ <strong>Composants UI :</strong> Interactifs</p>
          <p>✅ <strong>Logo CSS :</strong> Intégré (pas d'image externe)</p>
          <p>📝 <strong>Version :</strong> Index.html unifié</p>
          <hr style="border: 1px solid rgba(255,255,255,0.1); margin: 15px 0;">
          <p><strong>Compatible :</strong><br>
          - Ouverture directe (double-clic)<br>
          - Serveur HTTP (live-server, go.bat)</p>
        `;
      }

      // Fonction pour dessiner le menu cylindrique
      function drawCylMenu() {
        const menuCanvas = document.getElementById('menuCanvas');
        if (!menuCanvas) return;
        
        const header = document.querySelector('.topbar');
        const dpr = window.devicePixelRatio || 1;
        const w = header.clientWidth;
        const h = header.clientHeight;
        menuCanvas.style.position = 'absolute';
        menuCanvas.style.left = '0';
        menuCanvas.style.top = '0';
        menuCanvas.style.width = w + 'px';
        menuCanvas.style.height = h + 'px';
        menuCanvas.width = Math.floor(w * dpr);
        menuCanvas.height = Math.floor(h * dpr);
        const ctx = menuCanvas.getContext('2d');
        ctx.scale(dpr, dpr);
        ctx.clearRect(0, 0, w, h);

        const radius = Math.min(18, h / 2 - 2);
        const padding = 8;
        const barH = Math.max(h - padding * 2, 12);
        const barW = w - padding * 2;
        const x = padding;
        const y = (h - barH) / 2;

        const grd = ctx.createLinearGradient(0, y, 0, y + barH);
        grd.addColorStop(0, 'rgba(255,255,255,0.18)');
        grd.addColorStop(0.5, 'rgba(255,255,255,0.06)');
        grd.addColorStop(1, 'rgba(0,0,0,0.18)');

        ctx.beginPath();
        roundRect(ctx, x, y, barW, barH, radius);
        ctx.fillStyle = grd;
        ctx.fill();

        // highlight specular
        ctx.beginPath();
        roundRect(ctx, x + 2, y + 2, barW - 4, barH * 0.35, radius * 0.8);
        const hi = ctx.createLinearGradient(0, y + 2, 0, y + 2 + barH * 0.35);
        hi.addColorStop(0, 'rgba(255,255,255,0.25)');
        hi.addColorStop(1, 'rgba(255,255,255,0.02)');
        ctx.fillStyle = hi;
        ctx.fill();

        // shadow bottom
        ctx.beginPath();
        roundRect(ctx, x + 2, y + barH * 0.6, barW - 4, barH * 0.35, radius * 0.8);
        const sh = ctx.createLinearGradient(0, y + barH * 0.6, 0, y + barH);
        sh.addColorStop(0, 'rgba(0,0,0,0.08)');
        sh.addColorStop(1, 'rgba(0,0,0,0.18)');
        ctx.fillStyle = sh;
        ctx.fill();
      }

      function roundRect(ctx, x, y, width, height, radius) {
        const r = Math.max(0, Math.min(radius, height / 2));
        ctx.beginPath();
        ctx.moveTo(x + r, y);
        ctx.lineTo(x + width - r, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + r);
        ctx.lineTo(x + width, y + height - r);
        ctx.quadraticCurveTo(x + width, y + height, x + width - r, y + height);
        ctx.lineTo(x + r, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - r);
        ctx.lineTo(x, y + r);
        ctx.quadraticCurveTo(x, y, x + r, y);
        ctx.closePath();
      }

      // Variables globales pour la page Tirage
      let currentDataSource = 'mock'; // 'mock' ou 'scrap'
      let gainsExpanded = true; // Ouvert par défaut
      let resultsExpanded = true; // Ouvert par défaut

      // Fonctions pour la page Tirage
      function toggleDataSource() {
        const toggle = document.getElementById('dataToggle');
        // Logique inversée : checked = Scrap (à gauche), unchecked = Mock (à droite)
        currentDataSource = toggle.checked ? 'scrap' : 'mock';
        console.log('Source de données changée:', currentDataSource);
        
        // Mettre à jour visuellement les labels
        updateSwitchLabels();
      }
      
      function updateSwitchLabels() {
        const toggle = document.getElementById('dataToggle');
        const leftLabel = document.querySelector('.switch-label-left');
        const rightLabel = document.querySelector('.switch-label-right');
        
        if (toggle.checked) {
          // Mode Scrap actif
          leftLabel.style.opacity = '1';
          leftLabel.style.color = 'var(--accent)';
          rightLabel.style.opacity = '0.6';
          rightLabel.style.color = 'var(--fg)';
        } else {
          // Mode Mock actif
          leftLabel.style.opacity = '0.6';
          leftLabel.style.color = 'var(--fg)';
          rightLabel.style.opacity = '1';
          rightLabel.style.color = 'var(--accent)';
        }
      }

      function loadDraw() {
        const dateInput = document.getElementById('drawDate');
        const selectedDate = dateInput.value;
        
        if (!selectedDate) {
          alert('Veuillez sélectionner une date');
          return;
        }

        console.log('Chargement du tirage pour:', selectedDate, 'Source:', currentDataSource);
        
        // Simuler le chargement
        setTimeout(() => {
          displayDrawResult(selectedDate);
          displayGainsData();
        }, 500);
      }

      function displayDrawResult(date) {
        const resultsSection = document.getElementById('resultsSection');
        const resultDate = document.getElementById('resultDate');
        const resultBalls = document.getElementById('resultBalls');

        // Formatter la date
        const dateObj = new Date(date + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('fr-FR', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        resultDate.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);

        // Générer des numéros de tirage (mock ou réels selon la source)
        let numbers, stars;
        
        if (currentDataSource === 'mock') {
          // Données simulées
          numbers = [7, 14, 21, 28, 35];
          stars = [3, 9];
        } else {
          // Simuler des données scrappées (en attendant l'implémentation réelle)
          numbers = [5, 12, 18, 26, 49];
          stars = [2, 11];
        }

        // Créer les boules
        resultBalls.innerHTML = '';
        
        // Boules principales
        numbers.forEach(num => {
          const ball = document.createElement('div');
          ball.className = 'ball';
          ball.textContent = num;
          resultBalls.appendChild(ball);
        });

        // Étoiles
        stars.forEach(star => {
          const ball = document.createElement('div');
          ball.className = 'ball star';
          ball.textContent = star;
          resultBalls.appendChild(ball);
        });

        resultsSection.style.display = 'block';
      }

      function displayGainsData() {
        const gainsSection = document.getElementById('gainsSection');
        const gainsTableBody = document.getElementById('gainsTableBody');

        // Données de gains simulées
        const gainsData = [
          { rank: 1, combo: '5+2', winners: 0, gain: '220 000 000 €' },
          { rank: 2, combo: '5+1', winners: 3, gain: '852 214 €' },
          { rank: 3, combo: '5+0', winners: 8, gain: '45 628 €' },
          { rank: 4, combo: '4+2', winners: 47, gain: '4 086 €' },
          { rank: 5, combo: '4+1', winners: 892, gain: '215 €' },
          { rank: 6, combo: '3+2', winners: 1653, gain: '118 €' },
          { rank: 7, combo: '4+0', winners: 2107, gain: '91 €' },
          { rank: 8, combo: '2+2', winners: 25847, gain: '25 €' },
          { rank: 9, combo: '3+1', winners: 38526, gain: '18 €' },
          { rank: 10, combo: '3+0', winners: 91204, gain: '15 €' },
          { rank: 11, combo: '1+2', winners: 147852, gain: '8 €' },
          { rank: 12, combo: '2+1', winners: 698471, gain: '6 €' },
          { rank: 13, combo: '2+0', winners: 1654820, gain: '4 €' }
        ];

        // Vider le tableau
        gainsTableBody.innerHTML = '';

        // Remplir le tableau
        gainsData.forEach(data => {
          const row = document.createElement('tr');
          
          // Créer la combinaison avec icônes
          const comboCell = document.createElement('td');
          const comboDiv = document.createElement('div');
          comboDiv.className = 'result-combo';
          
          const [balls, starsCount] = data.combo.split('+');
          
          // Ajouter la boule avec le chiffre
          const ballIcon = document.createElement('span');
          ballIcon.className = 'combo-icon ball-icon';
          ballIcon.textContent = balls;
          comboDiv.appendChild(ballIcon);
          
          // Ajouter le signe +
          if (parseInt(starsCount) > 0) {
            const plus = document.createElement('span');
            plus.textContent = ' + ';
            plus.style.margin = '0 4px';
            comboDiv.appendChild(plus);
            
            // Ajouter l'étoile avec le chiffre
            const starIcon = document.createElement('span');
            starIcon.className = 'combo-icon star-icon';
            starIcon.textContent = starsCount;
            comboDiv.appendChild(starIcon);
          }
          
          comboCell.appendChild(comboDiv);

          // Formater le gain
          const gainCell = document.createElement('td');
          const gainSpan = document.createElement('span');
          gainSpan.className = 'gain-amount';
          gainSpan.textContent = data.gain;
          gainCell.appendChild(gainSpan);

          row.innerHTML = `
            <td>${data.rank}</td>
            <td></td>
            <td>${data.winners.toLocaleString('fr-FR')}</td>
            <td></td>
          `;
          
          // Remplacer les cellules vides par nos éléments
          row.cells[1].replaceWith(comboCell);
          row.cells[3].replaceWith(gainCell);

          gainsTableBody.appendChild(row);
        });

        gainsSection.style.display = 'block';
      }

      function toggleResults() {
        const resultsContent = document.getElementById('resultsContent');
        const resultsToggle = document.getElementById('resultsToggle');
        
        const isExpanded = resultsContent.classList.contains('expanded');
        
        if (isExpanded) {
          resultsContent.classList.remove('expanded');
          resultsToggle.classList.remove('expanded');
          resultsToggle.textContent = '▼';
        } else {
          resultsContent.classList.add('expanded');
          resultsToggle.classList.add('expanded');
          resultsToggle.textContent = '▲';
        }
      }

      function toggleGains() {
        const gainsContent = document.getElementById('gainsContent');
        const gainsToggle = document.getElementById('gainsToggle');
        
        const isExpanded = gainsContent.classList.contains('expanded');
        
        if (isExpanded) {
          gainsContent.classList.remove('expanded');
          gainsToggle.classList.remove('expanded');
          gainsToggle.textContent = '▼';
        } else {
          gainsContent.classList.add('expanded');
          gainsToggle.classList.add('expanded');
          gainsToggle.textContent = '▲';
        }
      }

      // Afficher la section d'accueil par défaut
      document.addEventListener('DOMContentLoaded', () => {
        console.log('🚀 FDJ Architecture OOP - Index unifié chargé');
        showSection('home');
        
        // Dessiner le menu cylindrique
        drawCylMenu();
        
        // Redessiner le menu lors du redimensionnement
        window.addEventListener('resize', drawCylMenu);
        
        // Initialiser l'état de l'interrupteur (Mock par défaut)
        setTimeout(() => {
          updateSwitchLabels();
        }, 100);
        
        // Afficher un message de confirmation
        setTimeout(() => {
          const status = document.querySelector('.status');
          if (status) {
            status.innerHTML = `
              <h3>✅ Système Opérationnel - ${new Date().toLocaleTimeString()}</h3>
              <p>Cette version fonctionne avec ou sans serveur HTTP et démontre l'architecture OOP refactorisée.</p>
              <p><strong>JavaScript chargé et fonctionnel !</strong></p>
              <p><strong>Menu cylindrique activé !</strong></p>
            `;
          }
        }, 100);
      });
    </script>
  </body>
</html>