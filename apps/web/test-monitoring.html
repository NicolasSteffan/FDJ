<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Monitoring SQLite</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #fff; padding: 20px; }
        button { padding: 10px; margin: 5px; background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; cursor: pointer; }
        button:hover { background: #444; }
        #logs { background: #000; padding: 15px; border-radius: 8px; margin-top: 20px; max-height: 400px; overflow-y: auto; }
        .log-line { margin-bottom: 2px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Test Monitoring SQLite Backend</h1>
    
    <div>
        <button onclick="testConnection()">ğŸ”— Test Connexion</button>
        <button onclick="testTableData()">ğŸ“Š Test DonnÃ©es Tables</button>
        <button onclick="testElements()">ğŸ” Test Ã‰lÃ©ments DOM</button>
        <button onclick="clearLogs()">ğŸ—‘ï¸ Clear Logs</button>
    </div>
    
    <div id="logs"></div>
    
    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        function log(message, color = '#00ff00') {
            const logs = document.getElementById('logs');
            const line = document.createElement('div');
            line.className = 'log-line';
            line.style.color = color;
            line.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logs.appendChild(line);
            logs.scrollTop = logs.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }
        
        async function testConnection() {
            log('ğŸ”„ Test connexion backend...', '#ffff00');
            
            try {
                const response = await fetch(`${API_BASE}/test-connection`);
                const result = await response.json();
                
                if (result.success) {
                    log('âœ… Connexion rÃ©ussie', '#00ff00');
                    log(`â° Heure serveur: ${result.server_time}`, '#00ff00');
                } else {
                    log(`âŒ Erreur: ${result.error}`, '#ff0000');
                }
            } catch (error) {
                log(`âŒ Erreur connexion: ${error.message}`, '#ff0000');
            }
        }
        
        async function testTableData() {
            log('ğŸ“Š Test rÃ©cupÃ©ration donnÃ©es...', '#ffff00');
            
            const tables = ['tirages', 'gains', 'sources', 'config', 'all'];
            
            for (const table of tables) {
                try {
                    log(`ğŸ” Test table: ${table}`, '#00aaff');
                    const response = await fetch(`${API_BASE}/tables/${table}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        log(`âœ… ${table}: ${result.count} enregistrements`, '#00ff00');
                        if (result.data && result.data.length > 0) {
                            const sample = result.data[0];
                            log(`   â””â”€ Ã‰chantillon: ${JSON.stringify(sample).substring(0, 100)}...`, '#00aaff');
                        }
                    } else {
                        log(`âŒ ${table}: ${result.error}`, '#ff0000');
                    }
                } catch (error) {
                    log(`âŒ ${table}: ${error.message}`, '#ff0000');
                }
            }
        }
        
        function testElements() {
            log('ğŸ” Test Ã©lÃ©ments DOM (depuis page principale)...', '#ffff00');
            
            // Test si on est dans la page principale
            if (window.opener || window.parent !== window) {
                log('âš ï¸ Test depuis popup/iframe - Ã©lÃ©ments peut-Ãªtre non disponibles', '#ffaa00');
            }
            
            // Test basique de l'environnement
            log(`ğŸ“‹ Document ready: ${document.readyState}`, '#00aaff');
            log(`ğŸŒ URL: ${window.location.href}`, '#00aaff');
            log(`ğŸ“Š DOM Ã©lÃ©ments: ${document.querySelectorAll('*').length}`, '#00aaff');
        }
        
        // Auto-test au chargement
        window.addEventListener('load', () => {
            log('ğŸš€ Page de test chargÃ©e', '#00ff00');
            log('ğŸ“‹ Cliquez sur les boutons pour tester chaque fonctionnalitÃ©', '#888');
        });
    </script>
</body>
</html>
